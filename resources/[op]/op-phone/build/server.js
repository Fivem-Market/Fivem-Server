/*! For license information please see server.js.LICENSE.txt */
(()=>{var e={2289:(e,t,r)=>{var n={};e.exports=n,n.themes={};var s=r(3837),o=n.styles=r(8982),i=Object.defineProperties,a=new RegExp(/[\r\n]+/g);n.supportsColor=r(8136).supportsColor,void 0===n.enabled&&(n.enabled=!1!==n.supportsColor()),n.enable=function(){n.enabled=!0},n.disable=function(){n.enabled=!1},n.stripColors=n.strip=function(e){return(""+e).replace(/\x1B\[\d+m/g,"")},n.stylize=function(e,t){if(!n.enabled)return e+"";var r=o[t];return!r&&t in n?n[t](e):r.open+e+r.close};var c=/[|\\{}()[\]^$+*?.]/g;function l(e){var t=function e(){return f.apply(e,arguments)};return t._styles=e,t.__proto__=h,t}var u,d=(u={},o.grey=o.gray,Object.keys(o).forEach((function(e){o[e].closeRe=new RegExp(function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(c,"\\$&")}(o[e].close),"g"),u[e]={get:function(){return l(this._styles.concat(e))}}})),u),h=i((function(){}),d);function f(){var e=Array.prototype.slice.call(arguments).map((function(e){return null!=e&&e.constructor===String?e:s.inspect(e)})).join(" ");if(!n.enabled||!e)return e;for(var t=-1!=e.indexOf("\n"),r=this._styles,i=r.length;i--;){var c=o[r[i]];e=c.open+e.replace(c.closeRe,c.open)+c.close,t&&(e=e.replace(a,(function(e){return c.close+e+c.open})))}return e}n.setTheme=function(e){if("string"!=typeof e)for(var t in e)!function(t){n[t]=function(r){if("object"==typeof e[t]){var s=r;for(var o in e[t])s=n[e[t][o]](s);return s}return n[e[t]](r)}}(t);else console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));")};var p=function(e,t){var r=t.split("");return(r=r.map(e)).join("")};for(var g in n.trap=r(8763),n.zalgo=r(750),n.maps={},n.maps.america=r(6278)(n),n.maps.zebra=r(848)(n),n.maps.rainbow=r(8823)(n),n.maps.random=r(9353)(n),n.maps)!function(e){n[e]=function(t){return p(n.maps[e],t)}}(g);i(n,function(){var e={};return Object.keys(d).forEach((function(t){e[t]={get:function(){return l([t])}}})),e}())},8763:e=>{e.exports=function(e,t){var r="";e=(e=e||"Run the trap, drop the bass").split("");var n={a:["@","Ą","Ⱥ","Ʌ","Δ","Λ","Д"],b:["ß","Ɓ","Ƀ","ɮ","β","฿"],c:["©","Ȼ","Ͼ"],d:["Ð","Ɗ","Ԁ","ԁ","Ԃ","ԃ"],e:["Ë","ĕ","Ǝ","ɘ","Σ","ξ","Ҽ","੬"],f:["Ӻ"],g:["ɢ"],h:["Ħ","ƕ","Ң","Һ","Ӈ","Ԋ"],i:["༏"],j:["Ĵ"],k:["ĸ","Ҡ","Ӄ","Ԟ"],l:["Ĺ"],m:["ʍ","Ӎ","ӎ","Ԡ","ԡ","൩"],n:["Ñ","ŋ","Ɲ","Ͷ","Π","Ҋ"],o:["Ø","õ","ø","Ǿ","ʘ","Ѻ","ם","۝","๏"],p:["Ƿ","Ҏ"],q:["্"],r:["®","Ʀ","Ȑ","Ɍ","ʀ","Я"],s:["§","Ϟ","ϟ","Ϩ"],t:["Ł","Ŧ","ͳ"],u:["Ʊ","Ս"],v:["ט"],w:["Ш","Ѡ","Ѽ","൰"],x:["Ҳ","Ӿ","Ӽ","ӽ"],y:["¥","Ұ","Ӌ"],z:["Ƶ","ɀ"]};return e.forEach((function(e){e=e.toLowerCase();var t=n[e]||[" "],s=Math.floor(Math.random()*t.length);r+=void 0!==n[e]?n[e][s]:e})),r}},750:e=>{e.exports=function(e,t){e=e||"   he is here   ";var r={up:["̍","̎","̄","̅","̿","̑","̆","̐","͒","͗","͑","̇","̈","̊","͂","̓","̈","͊","͋","͌","̃","̂","̌","͐","̀","́","̋","̏","̒","̓","̔","̽","̉","ͣ","ͤ","ͥ","ͦ","ͧ","ͨ","ͩ","ͪ","ͫ","ͬ","ͭ","ͮ","ͯ","̾","͛","͆","̚"],down:["̖","̗","̘","̙","̜","̝","̞","̟","̠","̤","̥","̦","̩","̪","̫","̬","̭","̮","̯","̰","̱","̲","̳","̹","̺","̻","̼","ͅ","͇","͈","͉","͍","͎","͓","͔","͕","͖","͙","͚","̣"],mid:["̕","̛","̀","́","͘","̡","̢","̧","̨","̴","̵","̶","͜","͝","͞","͟","͠","͢","̸","̷","͡"," ҉"]},n=[].concat(r.up,r.down,r.mid);function s(e){return Math.floor(Math.random()*e)}function o(e){var t=!1;return n.filter((function(r){t=r===e})),t}return function(e,t){var n,i,a="";for(i in(t=t||{}).up=void 0===t.up||t.up,t.mid=void 0===t.mid||t.mid,t.down=void 0===t.down||t.down,t.size=void 0!==t.size?t.size:"maxi",e=e.split(""))if(!o(i)){switch(a+=e[i],n={up:0,down:0,mid:0},t.size){case"mini":n.up=s(8),n.mid=s(2),n.down=s(8);break;case"maxi":n.up=s(16)+3,n.mid=s(4)+1,n.down=s(64)+3;break;default:n.up=s(8)+1,n.mid=s(6)/2,n.down=s(8)+1}var c=["up","mid","down"];for(var l in c)for(var u=c[l],d=0;d<=n[u];d++)t[u]&&(a+=r[u][s(r[u].length)])}return a}(e,t)}},6278:e=>{e.exports=function(e){return function(t,r,n){if(" "===t)return t;switch(r%3){case 0:return e.red(t);case 1:return e.white(t);case 2:return e.blue(t)}}}},8823:e=>{e.exports=function(e){var t=["red","yellow","green","blue","magenta"];return function(r,n,s){return" "===r?r:e[t[n++%t.length]](r)}}},9353:e=>{e.exports=function(e){var t=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(r,n,s){return" "===r?r:e[t[Math.round(Math.random()*(t.length-2))]](r)}}},848:e=>{e.exports=function(e){return function(t,r,n){return r%2==0?t:e.inverse(t)}}},8982:e=>{var t={};e.exports=t;var r={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(r).forEach((function(e){var n=r[e],s=t[e]=[];s.open="["+n[0]+"m",s.close="["+n[1]+"m"}))},3719:e=>{"use strict";e.exports=function(e,t){var r=(t=t||process.argv).indexOf("--"),n=/^-{1,2}/.test(e)?"":"--",s=t.indexOf(n+e);return-1!==s&&(-1===r||s<r)}},8136:(e,t,r)=>{"use strict";var n=r(2037),s=r(3719),o=process.env,i=void 0;function a(e){var t=function(e){if(!1===i)return 0;if(s("color=16m")||s("color=full")||s("color=truecolor"))return 3;if(s("color=256"))return 2;if(e&&!e.isTTY&&!0!==i)return 0;var t=i?1:0;if("win32"===process.platform){var r=n.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in o)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some((function(e){return e in o}))||"codeship"===o.CI_NAME?1:t;if("TEAMCITY_VERSION"in o)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in o){var a=parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Hyper":return 3;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM)||"COLORTERM"in o?1:(o.TERM,t)}(e);return function(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}(t)}s("no-color")||s("no-colors")||s("color=false")?i=!1:(s("color")||s("colors")||s("color=true")||s("color=always"))&&(i=!0),"FORCE_COLOR"in o&&(i=0===o.FORCE_COLOR.length||0!==parseInt(o.FORCE_COLOR,10)),e.exports={supportsColor:a,stdout:a(process.stdout),stderr:a(process.stderr)}},3645:(e,t,r)=>{var n=r(2289);e.exports=n},4099:e=>{var t=[],r=[],n=function(){};function s(e){return!~t.indexOf(e)&&(t.push(e),!0)}function o(e){n=e}function i(e){for(var r=[],n=0;n<t.length;n++)if(t[n].async)r.push(t[n]);else if(t[n](e))return!0;return!!r.length&&new Promise((function(t){Promise.all(r.map((function(t){return t(e)}))).then((function(e){t(e.some(Boolean))}))}))}function a(e){return!~r.indexOf(e)&&(r.push(e),!0)}function c(){n.apply(n,arguments)}function l(e){for(var t=0;t<r.length;t++)e=r[t].apply(r[t],arguments);return e}function u(e,t){var r=Object.prototype.hasOwnProperty;for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e}function d(e){return e.enabled=!1,e.modify=a,e.set=o,e.use=s,u((function(){return!1}),e)}function h(e){return e.enabled=!0,e.modify=a,e.set=o,e.use=s,u((function(){var t=Array.prototype.slice.call(arguments,0);return c.call(c,e,l(t,e)),!0}),e)}e.exports=function(e){return e.introduce=u,e.enabled=i,e.process=l,e.modify=a,e.write=c,e.nope=d,e.yep=h,e.set=o,e.use=s,e}},3420:(e,t,r)=>{e.exports=r(3601)},3601:(e,t,r)=>{var n=r(4099)((function e(t,r){return(r=r||{}).namespace=t,r.prod=!0,r.dev=!1,r.force||e.force?e.yep(r):e.nope(r)}));e.exports=n},4409:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,o.isAsync)(e)?function(...t){const r=t.pop();return a(e.apply(this,t),r)}:(0,n.default)((function(t,r){var n;try{n=e.apply(this,t)}catch(e){return r(e)}if(n&&"function"==typeof n.then)return a(n,r);r(null,n)}))};var n=i(r(3519)),s=i(r(3111)),o=r(8993);function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((e=>{c(t,null,e)}),(e=>{c(t,e&&e.message?e:new Error(e))}))}function c(e,t,r){try{e(t,r)}catch(e){(0,s.default)((e=>{throw e}),e)}}e.exports=t.default},1846:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(5616)),s=u(r(1605)),o=u(r(7388)),i=u(r(6979)),a=u(r(3362)),c=u(r(8993)),l=u(r(2795));function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t,r){r=(0,i.default)(r);var n=0,o=0,{length:c}=e,l=!1;function u(e,t){!1===e&&(l=!0),!0!==l&&(e?r(e):++o!==c&&t!==s.default||r(null))}for(0===c&&r(null);n<c;n++)t(e[n],n,(0,a.default)(u))}function h(e,t,r){return(0,o.default)(e,1/0,t,r)}t.default=(0,l.default)((function(e,t,r){return((0,n.default)(e)?d:h)(e,(0,c.default)(t),r)}),3),e.exports=t.default},7388:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(6954)),s=i(r(8993)),o=i(r(2795));function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t,r,o){return(0,n.default)(t)(e,(0,s.default)(r),o)}),4),e.exports=t.default},667:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(r(7388)),s=o(r(2795));function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,s.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default},8058:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(1846)),s=a(r(6529)),o=a(r(8993)),i=a(r(2795));function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,r){return(0,n.default)(e,(0,s.default)((0,o.default)(t)),r)}),3),e.exports=t.default},8617:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,n){let o=!1,i=!1,a=!1,c=0,l=0;function u(){c>=t||a||o||(a=!0,e.next().then((({value:e,done:t})=>{if(!i&&!o){if(a=!1,t)return o=!0,void(c<=0&&n(null));c++,r(e,l,d),l++,u()}})).catch(h))}function d(e,t){if(c-=1,!i)return e?h(e):!1===e?(o=!0,void(i=!0)):t===s.default||o&&c<=0?(o=!0,n(null)):void u()}function h(e){i||(a=!1,o=!0,n(e))}u()};var n,s=(n=r(1605))&&n.__esModule?n:{default:n};e.exports=t.default},2795:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t=e.length){if(!t)throw new Error("arity is undefined");return function(...r){return"function"==typeof r[t-1]?e.apply(this,r):new Promise(((n,s)=>{r[t-1]=(e,...t)=>{if(e)return s(e);n(t.length>1?t:t[0])},e.apply(this,r)}))}},e.exports=t.default},1605:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={},e.exports=t.default},6954:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(r(6979)),s=l(r(9733)),o=l(r(3362)),i=r(8993),a=l(r(8617)),c=l(r(1605));function l(e){return e&&e.__esModule?e:{default:e}}t.default=e=>(t,r,l)=>{if(l=(0,n.default)(l),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return l(null);if((0,i.isAsyncGenerator)(t))return(0,a.default)(t,e,r,l);if((0,i.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,r,l);var u=(0,s.default)(t),d=!1,h=!1,f=0,p=!1;function g(e,t){if(!h)if(f-=1,e)d=!0,l(e);else if(!1===e)d=!0,h=!0;else{if(t===c.default||d&&f<=0)return d=!0,l(null);p||m()}}function m(){for(p=!0;f<e&&!d;){var t=u();if(null===t)return d=!0,void(f<=0&&l(null));f+=1,r(t.value,t.key,(0,o.default)(g))}p=!1}m()},e.exports=t.default},7818:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default},3519:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(...t){var r=t.pop();return e.call(this,t,r)}},e.exports=t.default},5616:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default},9733:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,r=e.length;return function(){return++t<r?{value:e[t],key:t}:null}}(e);var t,r,o,i,a=(0,s.default)(e);return a?function(e){var t=-1;return function(){var r=e.next();return r.done?null:(t++,{value:r.value,key:t})}}(a):(r=(t=e)?Object.keys(t):[],o=-1,i=r.length,function e(){var n=r[++o];return"__proto__"===n?e():o<i?{value:t[n],key:n}:null})};var n=o(r(5616)),s=o(r(7818));function o(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default},6979:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(...t){if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default},3362:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(...t){if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default},3409:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(5616)),s=i(r(8993)),o=i(r(2795));function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)(((e,t,r)=>{var o=(0,n.default)(t)?[]:{};e(t,((e,t,r)=>{(0,s.default)(e)(((e,...n)=>{n.length<2&&([n]=n),o[t]=n,r(e)}))}),(e=>r(e,o)))}),3),e.exports=t.default},3111:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fallback=i,t.wrap=a;var r,n=t.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,s=t.hasSetImmediate="function"==typeof setImmediate&&setImmediate,o=t.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function i(e){setTimeout(e,0)}function a(e){return(t,...r)=>e((()=>t(...r)))}r=n?queueMicrotask:s?setImmediate:o?process.nextTick:i,t.default=a(r)},6529:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(t,r,n)=>e(t,n)},e.exports=t.default},8993:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAsyncIterable=t.isAsyncGenerator=t.isAsync=void 0;var n,s=(n=r(4409))&&n.__esModule?n:{default:n};function o(e){return"AsyncFunction"===e[Symbol.toStringTag]}t.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return o(e)?(0,s.default)(e):e},t.isAsync=o,t.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},t.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]}},8415:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(s.default,e,t)};var n=o(r(3409)),s=o(r(667));function o(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default},9432:(e,t,r)=>{"use strict";r.r(t),r.d(t,{assign:()=>u,default:()=>C,defaultI18n:()=>p,format:()=>O,parse:()=>M,setGlobalDateI18n:()=>m,setGlobalDateMasks:()=>A});var n=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|Z|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,s="\\d\\d?",o="\\d\\d",i="[^\\s]+",a=/\[([^]*?)\]/gm;function c(e,t){for(var r=[],n=0,s=e.length;n<s;n++)r.push(e[n].substr(0,t));return r}var l=function(e){return function(t,r){var n=r[e].map((function(e){return e.toLowerCase()})),s=n.indexOf(t.toLowerCase());return s>-1?s:null}};function u(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0,s=t;n<s.length;n++){var o=s[n];for(var i in o)e[i]=o[i]}return e}var d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=["January","February","March","April","May","June","July","August","September","October","November","December"],f=c(h,3),p={dayNamesShort:c(d,3),dayNames:d,monthNamesShort:f,monthNames:h,amPm:["am","pm"],DoFn:function(e){return e+["th","st","nd","rd"][e%10>3?0:(e-e%10!=10?1:0)*e%10]}},g=u({},p),m=function(e){return g=u(g,e)},y=function(e){return e.replace(/[|\\{()[^$+*?.-]/g,"\\$&")},E=function(e,t){for(void 0===t&&(t=2),e=String(e);e.length<t;)e="0"+e;return e},_={D:function(e){return String(e.getDate())},DD:function(e){return E(e.getDate())},Do:function(e,t){return t.DoFn(e.getDate())},d:function(e){return String(e.getDay())},dd:function(e){return E(e.getDay())},ddd:function(e,t){return t.dayNamesShort[e.getDay()]},dddd:function(e,t){return t.dayNames[e.getDay()]},M:function(e){return String(e.getMonth()+1)},MM:function(e){return E(e.getMonth()+1)},MMM:function(e,t){return t.monthNamesShort[e.getMonth()]},MMMM:function(e,t){return t.monthNames[e.getMonth()]},YY:function(e){return E(String(e.getFullYear()),4).substr(2)},YYYY:function(e){return E(e.getFullYear(),4)},h:function(e){return String(e.getHours()%12||12)},hh:function(e){return E(e.getHours()%12||12)},H:function(e){return String(e.getHours())},HH:function(e){return E(e.getHours())},m:function(e){return String(e.getMinutes())},mm:function(e){return E(e.getMinutes())},s:function(e){return String(e.getSeconds())},ss:function(e){return E(e.getSeconds())},S:function(e){return String(Math.round(e.getMilliseconds()/100))},SS:function(e){return E(Math.round(e.getMilliseconds()/10),2)},SSS:function(e){return E(e.getMilliseconds(),3)},a:function(e,t){return e.getHours()<12?t.amPm[0]:t.amPm[1]},A:function(e,t){return e.getHours()<12?t.amPm[0].toUpperCase():t.amPm[1].toUpperCase()},ZZ:function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+E(100*Math.floor(Math.abs(t)/60)+Math.abs(t)%60,4)},Z:function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+E(Math.floor(Math.abs(t)/60),2)+":"+E(Math.abs(t)%60,2)}},b=function(e){return+e-1},v=[null,s],S=[null,i],w=["isPm",i,function(e,t){var r=e.toLowerCase();return r===t.amPm[0]?0:r===t.amPm[1]?1:null}],T=["timezoneOffset","[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z?",function(e){var t=(e+"").match(/([+-]|\d\d)/gi);if(t){var r=60*+t[1]+parseInt(t[2],10);return"+"===t[0]?r:-r}return 0}],R={D:["day",s],DD:["day",o],Do:["day",s+i,function(e){return parseInt(e,10)}],M:["month",s,b],MM:["month",o,b],YY:["year",o,function(e){var t=+(""+(new Date).getFullYear()).substr(0,2);return+(""+(+e>68?t-1:t)+e)}],h:["hour",s,void 0,"isPm"],hh:["hour",o,void 0,"isPm"],H:["hour",s],HH:["hour",o],m:["minute",s],mm:["minute",o],s:["second",s],ss:["second",o],YYYY:["year","\\d{4}"],S:["millisecond","\\d",function(e){return 100*+e}],SS:["millisecond",o,function(e){return 10*+e}],SSS:["millisecond","\\d{3}"],d:v,dd:v,ddd:S,dddd:S,MMM:["month",i,l("monthNamesShort")],MMMM:["month",i,l("monthNames")],a:w,A:w,ZZ:T,Z:T},N={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",isoDate:"YYYY-MM-DD",isoDateTime:"YYYY-MM-DDTHH:mm:ssZ",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},A=function(e){return u(N,e)},O=function(e,t,r){if(void 0===t&&(t=N.default),void 0===r&&(r={}),"number"==typeof e&&(e=new Date(e)),"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))throw new Error("Invalid Date pass to format");t=N[t]||t;var s=[];t=t.replace(a,(function(e,t){return s.push(t),"@@@"}));var o=u(u({},g),r);return(t=t.replace(n,(function(t){return _[t](e,o)}))).replace(/@@@/g,(function(){return s.shift()}))};function M(e,t,r){if(void 0===r&&(r={}),"string"!=typeof t)throw new Error("Invalid format in fecha parse");if(t=N[t]||t,e.length>1e3)return null;var s={year:(new Date).getFullYear(),month:0,day:1,hour:0,minute:0,second:0,millisecond:0,isPm:null,timezoneOffset:null},o=[],i=[],c=t.replace(a,(function(e,t){return i.push(y(t)),"@@@"})),l={},d={};c=y(c).replace(n,(function(e){var t=R[e],r=t[0],n=t[1],s=t[3];if(l[r])throw new Error("Invalid format. "+r+" specified twice in format");return l[r]=!0,s&&(d[s]=!0),o.push(t),"("+n+")"})),Object.keys(d).forEach((function(e){if(!l[e])throw new Error("Invalid format. "+e+" is required in specified format")})),c=c.replace(/@@@/g,(function(){return i.shift()}));var h=e.match(new RegExp(c,"i"));if(!h)return null;for(var f,p=u(u({},g),r),m=1;m<h.length;m++){var E=o[m-1],_=E[0],b=E[2],v=b?b(h[m],p):+h[m];if(null==v)return null;s[_]=v}if(1===s.isPm&&null!=s.hour&&12!=+s.hour?s.hour=+s.hour+12:0===s.isPm&&12==+s.hour&&(s.hour=0),null==s.timezoneOffset){f=new Date(s.year,s.month,s.day,s.hour,s.minute,s.second,s.millisecond);for(var S=[["month","getMonth"],["day","getDate"],["hour","getHours"],["minute","getMinutes"],["second","getSeconds"]],w=(m=0,S.length);m<w;m++)if(l[S[m][0]]&&s[S[m][0]]!==f[S[m][1]]())return null}else if(f=new Date(Date.UTC(s.year,s.month,s.day,s.hour,s.minute-s.timezoneOffset,s.second,s.millisecond)),s.month>11||s.month<0||s.day>31||s.day<1||s.hour>23||s.hour<0||s.minute>59||s.minute<0||s.second>59||s.second<0)return null;return f}const C={format:O,parse:M,defaultI18n:p,setGlobalDateI18n:m,setGlobalDateMasks:A}},2296:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){if("string"==typeof e.displayName&&e.constructor.name)return e.displayName;if("string"==typeof e.name&&e.name)return e.name;if("object"==typeof e&&e.constructor&&"string"==typeof e.constructor.name)return e.constructor.name;var r=e.toString(),n=t.call(e).slice(8,-1);return(r="Function"===n?r.substring(r.indexOf("(")+1,r.indexOf(")")):n)||"anonymous"}},4378:(e,t,r)=>{try{var n=r(3837);if("function"!=typeof n.inherits)throw"";e.exports=n.inherits}catch(t){e.exports=r(5717)}},5717:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},4970:e=>{"use strict";const t=e=>null!==e&&"object"==typeof e&&"function"==typeof e.pipe;t.writable=e=>t(e)&&!1!==e.writable&&"function"==typeof e._write&&"object"==typeof e._writableState,t.readable=e=>t(e)&&!1!==e.readable&&"function"==typeof e._read&&"object"==typeof e._readableState,t.duplex=e=>t.writable(e)&&t.readable(e),t.transform=e=>t.duplex(e)&&"function"==typeof e._transform,e.exports=t},6281:(e,t,r)=>{"use strict";const n=r(9235);e.exports=n((e=>(e.message=`\t${e.message}`,e)))},153:(e,t,r)=>{"use strict";const{Colorizer:n}=r(8580),{Padder:s}=r(6566),{configs:o,MESSAGE:i}=r(5396);class a{constructor(e={}){e.levels||(e.levels=o.cli.levels),this.colorizer=new n(e),this.padder=new s(e),this.options=e}transform(e,t){return this.colorizer.transform(this.padder.transform(e,t),t),e[i]=`${e.level}:${e.message}`,e}}e.exports=e=>new a(e),e.exports.Format=a},8580:(e,t,r)=>{"use strict";const n=r(3645),{LEVEL:s,MESSAGE:o}=r(5396);n.enabled=!0;const i=/\s+/;class a{constructor(e={}){e.colors&&this.addColors(e.colors),this.options=e}static addColors(e){const t=Object.keys(e).reduce(((t,r)=>(t[r]=i.test(e[r])?e[r].split(i):e[r],t)),{});return a.allColors=Object.assign({},a.allColors||{},t),a.allColors}addColors(e){return a.addColors(e)}colorize(e,t,r){if(void 0===r&&(r=t),!Array.isArray(a.allColors[e]))return n[a.allColors[e]](r);for(let t=0,s=a.allColors[e].length;t<s;t++)r=n[a.allColors[e][t]](r);return r}transform(e,t){return t.all&&"string"==typeof e[o]&&(e[o]=this.colorize(e[s],e.level,e[o])),(t.level||t.all||!t.message)&&(e.level=this.colorize(e[s],e.level)),(t.all||t.message)&&(e.message=this.colorize(e[s],e.level,e.message)),e}}e.exports=e=>new a(e),e.exports.Colorizer=e.exports.Format=a},2390:(e,t,r)=>{"use strict";const n=r(9235);function s(e){if(e.every(o))return t=>{let r=t;for(let t=0;t<e.length;t++)if(r=e[t].transform(r,e[t].options),!r)return!1;return r}}function o(e){if("function"!=typeof e.transform)throw new Error(["No transform function found on format. Did you create a format instance?","const myFormat = format(formatFn);","const instance = myFormat();"].join("\n"));return!0}e.exports=(...e)=>{const t=n(s(e)),r=t();return r.Format=t.Format,r},e.exports.cascade=s},1648:(e,t,r)=>{"use strict";const n=r(9235),{LEVEL:s,MESSAGE:o}=r(5396);e.exports=n(((e,{stack:t,cause:r})=>{if(e instanceof Error){const n=Object.assign({},e,{level:e.level,[s]:e[s]||e.level,message:e.message,[o]:e[o]||e.message});return t&&(n.stack=e.stack),r&&(n.cause=e.cause),n}if(!(e.message instanceof Error))return e;const n=e.message;return Object.assign(e,n),e.message=n.message,e[o]=n.message,t&&(e.stack=n.stack),r&&(e.cause=n.cause),e}))},9235:e=>{"use strict";class t extends Error{constructor(e){super(`Format functions must be synchronous taking a two arguments: (info, opts)\nFound: ${e.toString().split("\n")[0]}\n`),Error.captureStackTrace(this,t)}}e.exports=e=>{if(e.length>2)throw new t(e);function r(e={}){this.options=e}function n(e){return new r(e)}return r.prototype.transform=e,n.Format=r,n}},562:(e,t,r)=>{"use strict";const n=t.format=r(9235);function s(e,t){Object.defineProperty(n,e,{get:()=>t(),configurable:!0})}t.levels=r(7823),s("align",(function(){return r(6281)})),s("errors",(function(){return r(1648)})),s("cli",(function(){return r(153)})),s("combine",(function(){return r(2390)})),s("colorize",(function(){return r(8580)})),s("json",(function(){return r(3922)})),s("label",(function(){return r(3084)})),s("logstash",(function(){return r(3388)})),s("metadata",(function(){return r(2523)})),s("ms",(function(){return r(7560)})),s("padLevels",(function(){return r(6566)})),s("prettyPrint",(function(){return r(5894)})),s("printf",(function(){return r(8242)})),s("simple",(function(){return r(459)})),s("splat",(function(){return r(8102)})),s("timestamp",(function(){return r(6645)})),s("uncolorize",(function(){return r(9095)}))},3922:(e,t,r)=>{"use strict";const n=r(9235),{MESSAGE:s}=r(5396),o=r(7668);function i(e,t){return"bigint"==typeof t?t.toString():t}e.exports=n(((e,t)=>{const r=o.configure(t);return e[s]=r(e,t.replacer||i,t.space),e}))},3084:(e,t,r)=>{"use strict";const n=r(9235);e.exports=n(((e,t)=>t.message?(e.message=`[${t.label}] ${e.message}`,e):(e.label=t.label,e)))},7823:(e,t,r)=>{"use strict";const{Colorizer:n}=r(8580);e.exports=e=>(n.addColors(e.colors||e),e)},3388:(e,t,r)=>{"use strict";const n=r(9235),{MESSAGE:s}=r(5396),o=r(7668);e.exports=n((e=>{const t={};return e.message&&(t["@message"]=e.message,delete e.message),e.timestamp&&(t["@timestamp"]=e.timestamp,delete e.timestamp),t["@fields"]=e,e[s]=o(t),e}))},2523:(e,t,r)=>{"use strict";const n=r(9235);e.exports=n(((e,t={})=>{let r="metadata";t.key&&(r=t.key);let n=[];return t.fillExcept||t.fillWith||(n.push("level"),n.push("message")),t.fillExcept&&(n=t.fillExcept),n.length>0?function(e,t,r){const n=t.reduce(((t,r)=>(t[r]=e[r],delete e[r],t)),{}),s=Object.keys(e).reduce(((t,r)=>(t[r]=e[r],delete e[r],t)),{});return Object.assign(e,n,{[r]:s}),e}(e,n,r):t.fillWith?function(e,t,r){return e[r]=t.reduce(((t,r)=>(t[r]=e[r],delete e[r],t)),{}),e}(e,t.fillWith,r):e}))},7560:function(e,t,r){"use strict";const n=r(9235),s=r(7824);e.exports=n((e=>{const t=+new Date;return this.diff=t-(this.prevTime||t),this.prevTime=t,e.ms=`+${s(this.diff)}`,e}))},6566:(e,t,r)=>{"use strict";const{configs:n,LEVEL:s,MESSAGE:o}=r(5396);class i{constructor(e={levels:n.npm.levels}){this.paddings=i.paddingForLevels(e.levels,e.filler),this.options=e}static getLongestLevel(e){const t=Object.keys(e).map((e=>e.length));return Math.max(...t)}static paddingForLevel(e,t,r){const n=r+1-e.length,s=Math.floor(n/t.length);return`${t}${t.repeat(s)}`.slice(0,n)}static paddingForLevels(e,t=" "){const r=i.getLongestLevel(e);return Object.keys(e).reduce(((e,n)=>(e[n]=i.paddingForLevel(n,t,r),e)),{})}transform(e,t){return e.message=`${this.paddings[e[s]]}${e.message}`,e[o]&&(e[o]=`${this.paddings[e[s]]}${e[o]}`),e}}e.exports=e=>new i(e),e.exports.Padder=e.exports.Format=i},5894:(e,t,r)=>{"use strict";const n=r(3837).inspect,s=r(9235),{LEVEL:o,MESSAGE:i,SPLAT:a}=r(5396);e.exports=s(((e,t={})=>{const r=Object.assign({},e);return delete r[o],delete r[i],delete r[a],e[i]=n(r,!1,t.depth||null,t.colorize),e}))},8242:(e,t,r)=>{"use strict";const{MESSAGE:n}=r(5396);class s{constructor(e){this.template=e}transform(e){return e[n]=this.template(e),e}}e.exports=e=>new s(e),e.exports.Printf=e.exports.Format=s},459:(e,t,r)=>{"use strict";const n=r(9235),{MESSAGE:s}=r(5396),o=r(7668);e.exports=n((e=>{const t=o(Object.assign({},e,{level:void 0,message:void 0,splat:void 0})),r=e.padding&&e.padding[e.level]||"";return e[s]="{}"!==t?`${e.level}:${r} ${e.message} ${t}`:`${e.level}:${r} ${e.message}`,e}))},8102:(e,t,r)=>{"use strict";const n=r(3837),{SPLAT:s}=r(5396),o=/%[scdjifoO%]/g,i=/%%/g;class a{constructor(e){this.options=e}_splat(e,t){const r=e.message,o=e[s]||e.splat||[],a=r.match(i),c=a&&a.length||0,l=t.length-c-o.length,u=l<0?o.splice(l,-1*l):[],d=u.length;if(d)for(let t=0;t<d;t++)Object.assign(e,u[t]);return e.message=n.format(r,...o),e}transform(e){const t=e.message,r=e[s]||e.splat;if(!r||!r.length)return e;const n=t&&t.match&&t.match(o);if(!n&&(r||r.length)){const t=r.length>1?r.splice(0):r,n=t.length;if(n)for(let r=0;r<n;r++)Object.assign(e,t[r]);return e}return n?this._splat(e,n):e}}e.exports=e=>new a(e)},6645:(e,t,r)=>{"use strict";const n=r(9432),s=r(9235);e.exports=s(((e,t={})=>(t.format&&(e.timestamp="function"==typeof t.format?t.format():n.format(new Date,t.format)),e.timestamp||(e.timestamp=(new Date).toISOString()),t.alias&&(e[t.alias]=e.timestamp),e)))},9095:(e,t,r)=>{"use strict";const n=r(3645),s=r(9235),{MESSAGE:o}=r(5396);e.exports=s(((e,t)=>(!1!==t.level&&(e.level=n.strip(e.level)),!1!==t.message&&(e.message=n.strip(String(e.message))),!1!==t.raw&&e[o]&&(e[o]=n.strip(String(e[o]))),e)))},7824:e=>{var t=1e3,r=60*t,n=60*r,s=24*n;function o(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}e.exports=function(e,i){i=i||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var i=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*s;case"hours":case"hour":case"hrs":case"hr":case"h":return i*n;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===l&&isFinite(e))return i.long?(a=e,(c=Math.abs(a))>=s?o(a,c,s,"day"):c>=n?o(a,c,n,"hour"):c>=r?o(a,c,r,"minute"):c>=t?o(a,c,t,"second"):a+" ms"):function(e){var o=Math.abs(e);return o>=s?Math.round(e/s)+"d":o>=n?Math.round(e/n)+"h":o>=r?Math.round(e/r)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},3138:(e,t,r)=>{"use strict";var n=r(2296);e.exports=function(e){var t,r=0;function s(){return r||(r=1,t=e.apply(this,arguments),e=null),t}return s.displayName=n(e),s}},4012:e=>{"use strict";const t={};function r(e,r,n){n||(n=Error);class s extends n{constructor(e,t,n){super(function(e,t,n){return"string"==typeof r?r:r(e,t,n)}(e,t,n))}}s.prototype.name=n.name,s.prototype.code=e,t[e]=s}function n(e,t){if(Array.isArray(e)){const r=e.length;return e=e.map((e=>String(e))),r>2?`one of ${t} ${e.slice(0,r-1).join(", ")}, or `+e[r-1]:2===r?`one of ${t} ${e[0]} or ${e[1]}`:`of ${t} ${e[0]}`}return`of ${t} ${String(e)}`}r("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),r("ERR_INVALID_ARG_TYPE",(function(e,t,r){let s;var o;let i;if("string"==typeof t&&(o="not ",t.substr(0,o.length)===o)?(s="must not be",t=t.replace(/^not /,"")):s="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))i=`The ${e} ${s} ${n(t,"type")}`;else{i=`The "${e}" ${"number"!=typeof c&&(c=0),c+".".length>(a=e).length||-1===a.indexOf(".",c)?"argument":"property"} ${s} ${n(t,"type")}`}var a,c;return i+=". Received type "+typeof r,i}),TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},6753:(e,t,r)=>{"use strict";var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=l;var s=r(9481),o=r(4229);r(4378)(l,s);for(var i=n(o.prototype),a=0;a<i.length;a++){var c=i[a];l.prototype[c]||(l.prototype[c]=o.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||process.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},2725:(e,t,r)=>{"use strict";e.exports=s;var n=r(4605);function s(e){if(!(this instanceof s))return new s(e);n.call(this,e)}r(4378)(s,n),s.prototype._transform=function(e,t,r){r(null,e)}},9481:(e,t,r)=>{"use strict";var n;e.exports=T,T.ReadableState=w,r(2361).EventEmitter;var s,o=function(e,t){return e.listeners(t).length},i=r(9740),a=r(4300).Buffer,c=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},l=r(3837);s=l&&l.debuglog?l.debuglog("stream"):function(){};var u,d,h,f=r(7327),p=r(1195),g=r(2457).getHighWaterMark,m=r(4012).q,y=m.ERR_INVALID_ARG_TYPE,E=m.ERR_STREAM_PUSH_AFTER_EOF,_=m.ERR_METHOD_NOT_IMPLEMENTED,b=m.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r(4378)(T,i);var v=p.errorOrDestroy,S=["error","close","destroy","pause","resume"];function w(e,t,s){n=n||r(6753),e=e||{},"boolean"!=typeof s&&(s=t instanceof n),this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=g(this,e,"readableHighWaterMark",s),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(u||(u=r(2553).s),this.decoder=new u(e.encoding),this.encoding=e.encoding)}function T(e){if(n=n||r(6753),!(this instanceof T))return new T(e);var t=this instanceof n;this._readableState=new w(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),i.call(this)}function R(e,t,r,n,o){s("readableAddChunk",t);var i,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(s("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?M(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,C(e)))}}(e,l);else if(o||(i=function(e,t){var r,n;return n=t,a.isBuffer(n)||n instanceof c||"string"==typeof t||void 0===t||e.objectMode||(r=new y("chunk",["string","Buffer","Uint8Array"],t)),r}(l,t)),i)v(e,i);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),n)l.endEmitted?v(e,new b):N(e,l,t,!0);else if(l.ended)v(e,new E);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!r?(t=l.decoder.write(t),l.objectMode||0!==t.length?N(e,l,t,!1):D(e,l)):N(e,l,t,!1)}else n||(l.reading=!1,D(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function N(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&M(e)),D(e,t)}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=p.destroy,T.prototype._undestroy=p.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=a.from(e,t),t=""),r=!0),R(this,e,t,!1,r)},T.prototype.unshift=function(e){return R(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(e){u||(u=r(2553).s);var t=new u(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,s="";null!==n;)s+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==s&&this._readableState.buffer.push(s),this._readableState.length=s.length,this};var A=1073741824;function O(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function M(e){var t=e._readableState;s("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(s("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(C,e))}function C(e){var t=e._readableState;s("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,$(e)}function D(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(P,e,t))}function P(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(s("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function x(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function L(e){s("readable nexttick read 0"),e.read(0)}function I(e,t){s("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),$(e),t.flowing&&!t.reading&&e.read(0)}function $(e){var t=e._readableState;for(s("flow",t.flowing);t.flowing&&null!==e.read(););}function j(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function k(e){var t=e._readableState;s("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(F,t,e))}function F(e,t){if(s("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function B(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}T.prototype.read=function(e){s("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return s("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?k(this):M(this),null;if(0===(e=O(e,t))&&t.ended)return 0===t.length&&k(this),null;var n,o=t.needReadable;return s("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&s("length less than watermark",o=!0),t.ended||t.reading?s("reading or ended",o=!1):o&&(s("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=O(r,t))),null===(n=e>0?j(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&k(this)),null!==n&&this.emit("data",n),n},T.prototype._read=function(e){v(this,new _("_read()"))},T.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,s("pipe count=%d opts=%j",n.pipesCount,t);var i=t&&!1===t.end||e===process.stdout||e===process.stderr?p:a;function a(){s("onend"),e.end()}n.endEmitted?process.nextTick(i):r.once("end",i),e.on("unpipe",(function t(o,i){s("onunpipe"),o===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,s("cleanup"),e.removeListener("close",h),e.removeListener("finish",f),e.removeListener("drain",c),e.removeListener("error",d),e.removeListener("unpipe",t),r.removeListener("end",a),r.removeListener("end",p),r.removeListener("data",u),l=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;s("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,$(e))}}(r);e.on("drain",c);var l=!1;function u(t){s("ondata");var o=e.write(t);s("dest.write",o),!1===o&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==B(n.pipes,e))&&!l&&(s("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function d(t){s("onerror",t),p(),e.removeListener("error",d),0===o(e,"error")&&v(e,t)}function h(){e.removeListener("finish",f),p()}function f(){s("onfinish"),e.removeListener("close",h),p()}function p(){s("unpipe"),r.unpipe(e)}return r.on("data",u),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",d),e.once("close",h),e.once("finish",f),e.emit("pipe",r),n.flowing||(s("pipe resume"),r.resume()),e},T.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,s=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<s;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var i=B(t.pipes,e);return-1===i||(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},T.prototype.on=function(e,t){var r=i.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"===e&&(n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,s("on readable",n.length,n.reading),n.length?M(this):n.reading||process.nextTick(L,this))),r},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(e,t){var r=i.prototype.removeListener.call(this,e,t);return"readable"===e&&process.nextTick(x,this),r},T.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||process.nextTick(x,this),t},T.prototype.resume=function(){var e=this._readableState;return e.flowing||(s("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(I,e,t))}(this,e)),e.paused=!1,this},T.prototype.pause=function(){return s("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(s("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var o in e.on("end",(function(){if(s("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(o){s("wrapped data"),r.decoder&&(o=r.decoder.write(o)),r.objectMode&&null==o||(r.objectMode||o&&o.length)&&(t.push(o)||(n=!0,e.pause()))})),e)void 0===this[o]&&"function"==typeof e[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));for(var i=0;i<S.length;i++)e.on(S[i],this.emit.bind(this,S[i]));return this._read=function(t){s("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=r(5850)),d(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=j,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(e,t){return void 0===h&&(h=r(6307)),h(T,e,t)})},4605:(e,t,r)=>{"use strict";e.exports=u;var n=r(4012).q,s=n.ERR_METHOD_NOT_IMPLEMENTED,o=n.ERR_MULTIPLE_CALLBACK,i=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0,c=r(6753);function l(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new o);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var s=this._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);c.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush((function(t,r){h(e,t,r)}))}function h(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new a;if(e._transformState.transforming)throw new i;return e.push(null)}r(4378)(u,c),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,r){r(new s("_transform()"))},u.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var s=this._readableState;(n.needTransform||s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))}},4229:(e,t,r)=>{"use strict";function n(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var s=n.callback;t.pendingcb--,s(undefined),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var s;e.exports=T,T.WritableState=w;var o,i={deprecate:r(1159)},a=r(9740),c=r(4300).Buffer,l=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},u=r(1195),d=r(2457).getHighWaterMark,h=r(4012).q,f=h.ERR_INVALID_ARG_TYPE,p=h.ERR_METHOD_NOT_IMPLEMENTED,g=h.ERR_MULTIPLE_CALLBACK,m=h.ERR_STREAM_CANNOT_PIPE,y=h.ERR_STREAM_DESTROYED,E=h.ERR_STREAM_NULL_VALUES,_=h.ERR_STREAM_WRITE_AFTER_END,b=h.ERR_UNKNOWN_ENCODING,v=u.errorOrDestroy;function S(){}function w(e,t,o){s=s||r(6753),e=e||{},"boolean"!=typeof o&&(o=t instanceof s),this.objectMode=!!e.objectMode,o&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",o),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,s=r.writecb;if("function"!=typeof s)throw new g;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,s){--t.pendingcb,r?(process.nextTick(s,n),process.nextTick(C,e,t),e._writableState.errorEmitted=!0,v(e,n)):(s(n),e._writableState.errorEmitted=!0,v(e,n),C(e,t))}(e,r,n,t,s);else{var o=O(r)||e.destroyed;o||r.corked||r.bufferProcessing||!r.bufferedRequest||A(e,r),n?process.nextTick(N,e,r,o,s):N(e,r,o,s)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function T(e){var t=this instanceof(s=s||r(6753));if(!t&&!o.call(T,this))return new T(e);this._writableState=new w(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),a.call(this)}function R(e,t,r,n,s,o,i){t.writelen=n,t.writecb=i,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):r?e._writev(s,t.onwrite):e._write(s,o,t.onwrite),t.sync=!1}function N(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),C(e,t)}function A(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var s=t.bufferedRequestCount,o=new Array(s),i=t.corkedRequestsFree;i.entry=r;for(var a=0,c=!0;r;)o[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;o.allBuffers=c,R(e,t,!0,t.length,o,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new n(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,d=r.callback;if(R(e,t,!1,t.objectMode?1:l.length,l,u,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function O(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function M(e,t){e._final((function(r){t.pendingcb--,r&&v(e,r),t.prefinished=!0,e.emit("prefinish"),C(e,t)}))}function C(e,t){var r=O(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,process.nextTick(M,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}r(4378)(T,a),w.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(w.prototype,"buffer",{get:i.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(o=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(e){return!!o.call(this,e)||this===T&&e&&e._writableState instanceof w}})):o=function(e){return e instanceof this},T.prototype.pipe=function(){v(this,new m)},T.prototype.write=function(e,t,r){var n,s=this._writableState,o=!1,i=!s.objectMode&&(n=e,c.isBuffer(n)||n instanceof l);return i&&!c.isBuffer(e)&&(e=function(e){return c.from(e)}(e)),"function"==typeof t&&(r=t,t=null),i?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof r&&(r=S),s.ending?function(e,t){var r=new _;v(e,r),process.nextTick(t,r)}(this,r):(i||function(e,t,r,n){var s;return null===r?s=new E:"string"==typeof r||t.objectMode||(s=new f("chunk",["string","Buffer"],r)),!s||(v(e,s),process.nextTick(n,s),!1)}(this,s,e,r))&&(s.pendingcb++,o=function(e,t,r,n,s,o){if(!r){var i=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,r)),t}(t,n,s);n!==i&&(r=!0,s="buffer",n=i)}var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:s,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else R(e,t,!1,a,n,s,o);return l}(this,s,i,e,t,r)),o},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},T.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new b(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),T.prototype._write=function(e,t,r){r(new p("_write()"))},T.prototype._writev=null,T.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||function(e,t,r){t.ending=!0,C(e,t),r&&(t.finished?process.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,n,r),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),T.prototype.destroy=u.destroy,T.prototype._undestroy=u.undestroy,T.prototype._destroy=function(e,t){t(e)}},5850:(e,t,r)=>{"use strict";var n;function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=r(8610),i=Symbol("lastResolve"),a=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function f(e,t){return{value:e,done:t}}function p(e){var t=e[i];if(null!==t){var r=e[h].read();null!==r&&(e[u]=null,e[i]=null,e[a]=null,t(f(r,!1)))}}function g(e){process.nextTick(p,e)}var m=Object.getPrototypeOf((function(){})),y=Object.setPrototypeOf((s(n={get stream(){return this[h]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(f(void 0,!0));if(this[h].destroyed)return new Promise((function(t,r){process.nextTick((function(){e[c]?r(e[c]):t(f(void 0,!0))}))}));var r,n=this[u];if(n)r=new Promise(function(e,t){return function(r,n){e.then((function(){t[l]?r(f(void 0,!0)):t[d](r,n)}),n)}}(n,this));else{var s=this[h].read();if(null!==s)return Promise.resolve(f(s,!1));r=new Promise(this[d])}return this[u]=r,r}},Symbol.asyncIterator,(function(){return this})),s(n,"return",(function(){var e=this;return new Promise((function(t,r){e[h].destroy(null,(function(e){e?r(e):t(f(void 0,!0))}))}))})),n),m);e.exports=function(e){var t,r=Object.create(y,(s(t={},h,{value:e,writable:!0}),s(t,i,{value:null,writable:!0}),s(t,a,{value:null,writable:!0}),s(t,c,{value:null,writable:!0}),s(t,l,{value:e._readableState.endEmitted,writable:!0}),s(t,d,{value:function(e,t){var n=r[h].read();n?(r[u]=null,r[i]=null,r[a]=null,e(f(n,!1))):(r[i]=e,r[a]=t)},writable:!0}),t));return r[u]=null,o(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[a];return null!==t&&(r[u]=null,r[i]=null,r[a]=null,t(e)),void(r[c]=e)}var n=r[i];null!==n&&(r[u]=null,r[i]=null,r[a]=null,n(f(void 0,!0))),r[l]=!0})),e.on("readable",g.bind(null,r)),r}},7327:(e,t,r)=>{"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}var c=r(4300).Buffer,l=r(3837).inspect,u=l&&l.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r;return t=e,(r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t,r,n,s=c.allocUnsafe(e>>>0),o=this.head,i=0;o;)t=o.data,r=s,n=i,c.prototype.copy.call(t,r,n),i+=o.data.length,o=o.next;return s}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var s=t.data,o=e>s.length?s.length:e;if(o===s.length?n+=s:n+=s.slice(0,e),0==(e-=o)){o===s.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=s.slice(o));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var s=r.data,o=e>s.length?s.length:e;if(s.copy(t,t.length-e,0,o),0==(e-=o)){o===s.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=s.slice(o));break}++n}return this.length-=n,t}},{key:u,value:function(e,t){return l(this,s(s({},t),{},{depth:0,customInspect:!1}))}}])&&i(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()},1195:e=>{"use strict";function t(e,t){n(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function n(e,t){e.emit("error",t)}e.exports={destroy:function(e,s){var o=this,i=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return i||a?(s?s(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(n,this,e)):process.nextTick(n,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!s&&e?o._writableState?o._writableState.errorEmitted?process.nextTick(r,o):(o._writableState.errorEmitted=!0,process.nextTick(t,o,e)):process.nextTick(t,o,e):s?(process.nextTick(r,o),s(e)):process.nextTick(r,o)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}},8610:(e,t,r)=>{"use strict";var n=r(4012).q.ERR_STREAM_PREMATURE_CLOSE;function s(){}e.exports=function e(t,r,o){if("function"==typeof r)return e(t,null,r);r||(r={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];e.apply(this,n)}}}(o||s);var i=r.readable||!1!==r.readable&&t.readable,a=r.writable||!1!==r.writable&&t.writable,c=function(){t.writable||u()},l=t._writableState&&t._writableState.finished,u=function(){a=!1,l=!0,i||o.call(t)},d=t._readableState&&t._readableState.endEmitted,h=function(){i=!1,d=!0,a||o.call(t)},f=function(e){o.call(t,e)},p=function(){var e;return i&&!d?(t._readableState&&t._readableState.ended||(e=new n),o.call(t,e)):a&&!l?(t._writableState&&t._writableState.ended||(e=new n),o.call(t,e)):void 0},g=function(){t.req.on("finish",u)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",u),t.on("abort",p),t.req?g():t.on("request",g)):a&&!t._writableState&&(t.on("end",c),t.on("close",c)),t.on("end",h),t.on("finish",u),!1!==r.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",u),t.removeListener("abort",p),t.removeListener("request",g),t.req&&t.req.removeListener("finish",u),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",u),t.removeListener("end",h),t.removeListener("error",f),t.removeListener("close",p)}}},6307:(e,t,r)=>{"use strict";function n(e,t,r,n,s,o,i){try{var a=e[o](i),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,s)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=r(4012).q.ERR_INVALID_ARG_TYPE;e.exports=function(e,t,r){var a;if(t&&"function"==typeof t.next)a=t;else if(t&&t[Symbol.asyncIterator])a=t[Symbol.asyncIterator]();else{if(!t||!t[Symbol.iterator])throw new i("iterable",["Iterable"],t);a=t[Symbol.iterator]()}var c=new e(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({objectMode:!0},r)),l=!1;function u(){return d.apply(this,arguments)}function d(){var e;return e=function*(){try{var e=yield a.next(),t=e.value;e.done?c.push(null):c.push(yield t)?u():l=!1}catch(e){c.destroy(e)}},d=function(){var t=this,r=arguments;return new Promise((function(s,o){var i=e.apply(t,r);function a(e){n(i,s,o,a,c,"next",e)}function c(e){n(i,s,o,a,c,"throw",e)}a(void 0)}))},d.apply(this,arguments)}return c._read=function(){l||(l=!0,u())},c}},9946:(e,t,r)=>{"use strict";var n,s=r(4012).q,o=s.ERR_MISSING_ARGS,i=s.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function c(e){e()}function l(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];var u,d=function(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var h=t.map((function(e,s){var o=s<t.length-1;return function(e,t,s,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;e.on("close",(function(){a=!0})),void 0===n&&(n=r(8610)),n(e,{readable:t,writable:s},(function(e){if(e)return o(e);a=!0,o()}));var c=!1;return function(t){if(!a&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new i("pipe"))}}(e,o,s>0,(function(e){u||(u=e),e&&h.forEach(c),o||(h.forEach(c),d(u))}))}));return t.reduce(l)}},2457:(e,t,r)=>{"use strict";var n=r(4012).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,r,s){var o=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,s,r);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new n(s?r:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},9740:(e,t,r)=>{e.exports=r(2781)},1451:(e,t,r)=>{var n=r(2781);"disable"===process.env.READABLE_STREAM&&n?(e.exports=n.Readable,Object.assign(e.exports,n),e.exports.Stream=n):((t=e.exports=r(9481)).Stream=n||t,t.Readable=t,t.Writable=r(4229),t.Duplex=r(6753),t.Transform=r(4605),t.PassThrough=r(2725),t.finished=r(8610),t.pipeline=r(9946))},9509:(e,t,r)=>{var n=r(4300),s=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function i(e,t,r){return s(e,t,r)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=i),i.prototype=Object.create(s.prototype),o(s,i),i.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,r)},i.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=s(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},7668:(e,t)=>{"use strict";const{hasOwnProperty:r}=Object.prototype,n=f();n.configure=f,n.stringify=n,n.default=n,t.stringify=n,t.configure=f,e.exports=n;const s=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/;function o(e){return e.length<5e3&&!s.test(e)?`"${e}"`:JSON.stringify(e)}function i(e){if(e.length>200)return e.sort();for(let t=1;t<e.length;t++){const r=e[t];let n=t;for(;0!==n&&e[n-1]>r;)e[n]=e[n-1],n--;e[n]=r}return e}const a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function c(e){return void 0!==a.call(e)&&0!==e.length}function l(e,t,r){e.length<r&&(r=e.length);const n=","===t?"":" ";let s=`"0":${n}${e[0]}`;for(let o=1;o<r;o++)s+=`${t}"${o}":${n}${e[o]}`;return s}function u(e,t){let n;if(r.call(e,t)&&(n=e[t],"boolean"!=typeof n))throw new TypeError(`The "${t}" argument must be of type boolean`);return void 0===n||n}function d(e,t){let n;if(r.call(e,t)){if(n=e[t],"number"!=typeof n)throw new TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(n))throw new TypeError(`The "${t}" argument must be an integer`);if(n<1)throw new RangeError(`The "${t}" argument must be >= 1`)}return void 0===n?1/0:n}function h(e){return 1===e?"1 item":`${e} items`}function f(e){const t=function(e){if(r.call(e,"strict")){const t=e.strict;if("boolean"!=typeof t)throw new TypeError('The "strict" argument must be of type boolean');if(t)return e=>{let t="Object can not safely be stringified. Received type "+typeof e;throw"function"!=typeof e&&(t+=` (${e.toString()})`),new Error(t)}}}(e={...e});t&&(void 0===e.bigint&&(e.bigint=!1),"circularValue"in e||(e.circularValue=Error));const n=function(e){if(r.call(e,"circularValue")){const t=e.circularValue;if("string"==typeof t)return`"${t}"`;if(null==t)return t;if(t===Error||t===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}(e),s=u(e,"bigint"),a=u(e,"deterministic"),f=d(e,"maximumDepth"),p=d(e,"maximumBreadth");function g(e,r,l,u,d,m){let y=r[e];switch("object"==typeof y&&null!==y&&"function"==typeof y.toJSON&&(y=y.toJSON(e)),y=u.call(r,e,y),typeof y){case"string":return o(y);case"object":{if(null===y)return"null";if(-1!==l.indexOf(y))return n;let e="",t=",";const r=m;if(Array.isArray(y)){if(0===y.length)return"[]";if(f<l.length+1)return'"[Array]"';l.push(y),""!==d&&(e+=`\n${m+=d}`,t=`,\n${m}`);const n=Math.min(y.length,p);let s=0;for(;s<n-1;s++){const r=g(String(s),y,l,u,d,m);e+=void 0!==r?r:"null",e+=t}const o=g(String(s),y,l,u,d,m);return e+=void 0!==o?o:"null",y.length-1>p&&(e+=`${t}"... ${h(y.length-p-1)} not stringified"`),""!==d&&(e+=`\n${r}`),l.pop(),`[${e}]`}let s=Object.keys(y);const E=s.length;if(0===E)return"{}";if(f<l.length+1)return'"[Object]"';let _="",b="";""!==d&&(t=`,\n${m+=d}`,_=" ");const v=Math.min(E,p);a&&!c(y)&&(s=i(s)),l.push(y);for(let r=0;r<v;r++){const n=s[r],i=g(n,y,l,u,d,m);void 0!==i&&(e+=`${b}${o(n)}:${_}${i}`,b=t)}return E>p&&(e+=`${b}"...":${_}"${h(E-p)} not stringified"`,b=t),""!==d&&b.length>1&&(e=`\n${m}${e}\n${r}`),l.pop(),`{${e}}`}case"number":return isFinite(y)?String(y):t?t(y):"null";case"boolean":return!0===y?"true":"false";case"undefined":return;case"bigint":if(s)return String(y);default:return t?t(y):void 0}}function m(e,r,i,a,c,l){switch("object"==typeof r&&null!==r&&"function"==typeof r.toJSON&&(r=r.toJSON(e)),typeof r){case"string":return o(r);case"object":{if(null===r)return"null";if(-1!==i.indexOf(r))return n;const e=l;let t="",s=",";if(Array.isArray(r)){if(0===r.length)return"[]";if(f<i.length+1)return'"[Array]"';i.push(r),""!==c&&(t+=`\n${l+=c}`,s=`,\n${l}`);const n=Math.min(r.length,p);let o=0;for(;o<n-1;o++){const e=m(String(o),r[o],i,a,c,l);t+=void 0!==e?e:"null",t+=s}const u=m(String(o),r[o],i,a,c,l);return t+=void 0!==u?u:"null",r.length-1>p&&(t+=`${s}"... ${h(r.length-p-1)} not stringified"`),""!==c&&(t+=`\n${e}`),i.pop(),`[${t}]`}i.push(r);let u="";""!==c&&(s=`,\n${l+=c}`,u=" ");let d="";for(const e of a){const n=m(e,r[e],i,a,c,l);void 0!==n&&(t+=`${d}${o(e)}:${u}${n}`,d=s)}return""!==c&&d.length>1&&(t=`\n${l}${t}\n${e}`),i.pop(),`{${t}}`}case"number":return isFinite(r)?String(r):t?t(r):"null";case"boolean":return!0===r?"true":"false";case"undefined":return;case"bigint":if(s)return String(r);default:return t?t(r):void 0}}function y(e,r,u,d,g){switch(typeof r){case"string":return o(r);case"object":{if(null===r)return"null";if("function"==typeof r.toJSON){if("object"!=typeof(r=r.toJSON(e)))return y(e,r,u,d,g);if(null===r)return"null"}if(-1!==u.indexOf(r))return n;const t=g;if(Array.isArray(r)){if(0===r.length)return"[]";if(f<u.length+1)return'"[Array]"';u.push(r);let e=`\n${g+=d}`;const n=`,\n${g}`,s=Math.min(r.length,p);let o=0;for(;o<s-1;o++){const t=y(String(o),r[o],u,d,g);e+=void 0!==t?t:"null",e+=n}const i=y(String(o),r[o],u,d,g);return e+=void 0!==i?i:"null",r.length-1>p&&(e+=`${n}"... ${h(r.length-p-1)} not stringified"`),e+=`\n${t}`,u.pop(),`[${e}]`}let s=Object.keys(r);const m=s.length;if(0===m)return"{}";if(f<u.length+1)return'"[Object]"';const E=`,\n${g+=d}`;let _="",b="",v=Math.min(m,p);c(r)&&(_+=l(r,E,p),s=s.slice(r.length),v-=r.length,b=E),a&&(s=i(s)),u.push(r);for(let e=0;e<v;e++){const t=s[e],n=y(t,r[t],u,d,g);void 0!==n&&(_+=`${b}${o(t)}: ${n}`,b=E)}return m>p&&(_+=`${b}"...": "${h(m-p)} not stringified"`,b=E),""!==b&&(_=`\n${g}${_}\n${t}`),u.pop(),`{${_}}`}case"number":return isFinite(r)?String(r):t?t(r):"null";case"boolean":return!0===r?"true":"false";case"undefined":return;case"bigint":if(s)return String(r);default:return t?t(r):void 0}}function E(e,r,u){switch(typeof r){case"string":return o(r);case"object":{if(null===r)return"null";if("function"==typeof r.toJSON){if("object"!=typeof(r=r.toJSON(e)))return E(e,r,u);if(null===r)return"null"}if(-1!==u.indexOf(r))return n;let t="";if(Array.isArray(r)){if(0===r.length)return"[]";if(f<u.length+1)return'"[Array]"';u.push(r);const e=Math.min(r.length,p);let n=0;for(;n<e-1;n++){const e=E(String(n),r[n],u);t+=void 0!==e?e:"null",t+=","}const s=E(String(n),r[n],u);return t+=void 0!==s?s:"null",r.length-1>p&&(t+=`,"... ${h(r.length-p-1)} not stringified"`),u.pop(),`[${t}]`}let s=Object.keys(r);const d=s.length;if(0===d)return"{}";if(f<u.length+1)return'"[Object]"';let g="",m=Math.min(d,p);c(r)&&(t+=l(r,",",p),s=s.slice(r.length),m-=r.length,g=","),a&&(s=i(s)),u.push(r);for(let e=0;e<m;e++){const n=s[e],i=E(n,r[n],u);void 0!==i&&(t+=`${g}${o(n)}:${i}`,g=",")}return d>p&&(t+=`${g}"...":"${h(d-p)} not stringified"`),u.pop(),`{${t}}`}case"number":return isFinite(r)?String(r):t?t(r):"null";case"boolean":return!0===r?"true":"false";case"undefined":return;case"bigint":if(s)return String(r);default:return t?t(r):void 0}}return function(e,t,r){if(arguments.length>1){let n="";if("number"==typeof r?n=" ".repeat(Math.min(r,10)):"string"==typeof r&&(n=r.slice(0,10)),null!=t){if("function"==typeof t)return g("",{"":e},[],t,n,"");if(Array.isArray(t))return m("",e,[],function(e){const t=new Set;for(const r of e)"string"!=typeof r&&"number"!=typeof r||t.add(String(r));return t}(t),n,"")}if(0!==n.length)return y("",e,[],n,"")}return E("",e,[])}}},7911:(e,t)=>{function r(e){for(var t in e)this[t]=e[t]}t.get=function(e){var r=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var n={},s=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t},Error.captureStackTrace(n,e||t.get);var o=n.stack;return Error.prepareStackTrace=s,Error.stackTraceLimit=r,o},t.parse=function(e){if(!e.stack)return[];var t=this;return e.stack.split("\n").slice(1).map((function(e){if(e.match(/^\s*[-]{4,}$/))return t._createParsedCallSite({fileName:e,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var r=e.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(r){var n=null,s=null,o=null,i=null,a=null,c="native"===r[5];if(r[1]){var l=(o=r[1]).lastIndexOf(".");if("."==o[l-1]&&l--,l>0){n=o.substr(0,l),s=o.substr(l+1);var u=n.indexOf(".Module");u>0&&(o=o.substr(u+1),n=n.substr(0,u))}i=null}s&&(i=n,a=s),"<anonymous>"===s&&(a=null,o=null);var d={fileName:r[2]||null,lineNumber:parseInt(r[3],10)||null,functionName:o,typeName:i,methodName:a,columnNumber:parseInt(r[4],10)||null,native:c};return t._createParsedCallSite(d)}})).filter((function(e){return!!e}))},["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"].forEach((function(e){r.prototype[e]=null,r.prototype["get"+e[0].toUpperCase()+e.substr(1)]=function(){return this[e]}})),["topLevel","eval","native","constructor"].forEach((function(e){r.prototype[e]=!1,r.prototype["is"+e[0].toUpperCase()+e.substr(1)]=function(){return this[e]}})),t._createParsedCallSite=function(e){return new r(e)}},2553:(e,t,r)=>{"use strict";var n=r(9509).Buffer,s=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===s||!s(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function i(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.s=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var s=i(t[n]);return s>=0?(s>0&&(e.lastNeed=s-1),s):--n<r||-2===s?0:(s=i(t[n]))>=0?(s>0&&(e.lastNeed=s-2),s):--n<r||-2===s?0:(s=i(t[n]))>=0?(s>0&&(2===s?s=0:e.lastNeed=s-3),s):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},9273:(e,t)=>{"use strict";t.levels={error:0,warn:1,help:2,data:3,info:4,debug:5,prompt:6,verbose:7,input:8,silly:9},t.colors={error:"red",warn:"yellow",help:"cyan",data:"grey",info:"green",debug:"blue",prompt:"grey",verbose:"cyan",input:"grey",silly:"magenta"}},5243:(e,t,r)=>{"use strict";Object.defineProperty(t,"cli",{value:r(9273)}),Object.defineProperty(t,"npm",{value:r(2459)}),Object.defineProperty(t,"syslog",{value:r(1945)})},2459:(e,t)=>{"use strict";t.levels={error:0,warn:1,info:2,http:3,verbose:4,debug:5,silly:6},t.colors={error:"red",warn:"yellow",info:"green",http:"green",verbose:"cyan",debug:"blue",silly:"magenta"}},1945:(e,t)=>{"use strict";t.levels={emerg:0,alert:1,crit:2,error:3,warning:4,notice:5,info:6,debug:7},t.colors={emerg:"red",alert:"yellow",crit:"red",error:"red",warning:"red",notice:"yellow",info:"green",debug:"blue"}},5396:(e,t,r)=>{"use strict";Object.defineProperty(t,"LEVEL",{value:Symbol.for("level")}),Object.defineProperty(t,"MESSAGE",{value:Symbol.for("message")}),Object.defineProperty(t,"SPLAT",{value:Symbol.for("splat")}),Object.defineProperty(t,"configs",{value:r(5243)})},1159:(e,t,r)=>{e.exports=r(3837).deprecate},1037:(e,t,r)=>{"use strict";const n=r(3837),s=r(4229),{LEVEL:o}=r(5396),i=e.exports=function(e={}){s.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this.format=e.format,this.level=e.level,this.handleExceptions=e.handleExceptions,this.handleRejections=e.handleRejections,this.silent=e.silent,e.log&&(this.log=e.log),e.logv&&(this.logv=e.logv),e.close&&(this.close=e.close),this.once("pipe",(e=>{this.levels=e.levels,this.parent=e})),this.once("unpipe",(e=>{e===this.parent&&(this.parent=null,this.close&&this.close())}))};n.inherits(i,s),i.prototype._write=function(e,t,r){if(this.silent||!0===e.exception&&!this.handleExceptions)return r(null);const n=this.level||this.parent&&this.parent.level;if(!n||this.levels[n]>=this.levels[e[o]]){if(e&&!this.format)return this.log(e,r);let t,n;try{n=this.format.transform(Object.assign({},e),this.format.options)}catch(e){t=e}if(t||!n){if(r(),t)throw t;return}return this.log(n,r)}return this._writableState.sync=!1,r(null)},i.prototype._writev=function(e,t){if(this.logv){const r=e.filter(this._accept,this);return r.length?this.logv(r,t):t(null)}for(let r=0;r<e.length;r++){if(!this._accept(e[r]))continue;if(e[r].chunk&&!this.format){this.log(e[r].chunk,e[r].callback);continue}let n,s;try{s=this.format.transform(Object.assign({},e[r].chunk),this.format.options)}catch(e){n=e}if(n||!s){if(e[r].callback(),n)throw t(null),n}else this.log(s,e[r].callback)}return t(null)},i.prototype._accept=function(e){const t=e.chunk;if(this.silent)return!1;const r=this.level||this.parent&&this.parent.level;return!(!0!==t.exception&&r&&!(this.levels[r]>=this.levels[t[o]])||!this.handleExceptions&&!0===t.exception)},i.prototype._nop=function(){},e.exports.LegacyTransportStream=r(4201)},4201:(e,t,r)=>{"use strict";const n=r(3837),{LEVEL:s}=r(5396),o=r(1037),i=e.exports=function(e={}){if(o.call(this,e),!e.transport||"function"!=typeof e.transport.log)throw new Error("Invalid transport, must be an object with a log method.");this.transport=e.transport,this.level=this.level||e.transport.level,this.handleExceptions=this.handleExceptions||e.transport.handleExceptions,this._deprecated(),this.transport.__winstonError||(this.transport.__winstonError=function(e){this.emit("error",e,this.transport)}.bind(this),this.transport.on("error",this.transport.__winstonError))};n.inherits(i,o),i.prototype._write=function(e,t,r){if(this.silent||!0===e.exception&&!this.handleExceptions)return r(null);(!this.level||this.levels[this.level]>=this.levels[e[s]])&&this.transport.log(e[s],e.message,e,this._nop),r(null)},i.prototype._writev=function(e,t){for(let t=0;t<e.length;t++)this._accept(e[t])&&(this.transport.log(e[t].chunk[s],e[t].chunk.message,e[t].chunk,this._nop),e[t].callback());return t(null)},i.prototype._deprecated=function(){console.error([`${this.transport.name} is a legacy winston transport. Consider upgrading: `,"- Upgrade docs: https://github.com/winstonjs/winston/blob/master/UPGRADE-3.0.md"].join("\n"))},i.prototype.close=function(){this.transport.close&&this.transport.close(),this.transport.__winstonError&&(this.transport.removeListener("error",this.transport.__winstonError),this.transport.__winstonError=null)}},1440:(e,t,r)=>{"use strict";const n=r(562),{warn:s}=r(2850);t.version=r(2561).version,t.transports=r(9840),t.config=r(448),t.addColors=n.levels,t.format=n.format,t.createLogger=r(5658),t.ExceptionHandler=r(5120),t.RejectionHandler=r(5724),t.Container=r(6099),t.Transport=r(1037),t.loggers=new t.Container;const o=t.createLogger();Object.keys(t.config.npm.levels).concat(["log","query","stream","add","remove","clear","profile","startTimer","handleExceptions","unhandleExceptions","handleRejections","unhandleRejections","configure","child"]).forEach((e=>t[e]=(...t)=>o[e](...t))),Object.defineProperty(t,"level",{get:()=>o.level,set(e){o.level=e}}),Object.defineProperty(t,"exceptions",{get:()=>o.exceptions}),["exitOnError"].forEach((e=>{Object.defineProperty(t,e,{get:()=>o[e],set(t){o[e]=t}})})),Object.defineProperty(t,"default",{get:()=>({exceptionHandlers:o.exceptionHandlers,rejectionHandlers:o.rejectionHandlers,transports:o.transports})}),s.deprecated(t,"setLevels"),s.forFunctions(t,"useFormat",["cli"]),s.forProperties(t,"useFormat",["padLevels","stripColors"]),s.forFunctions(t,"deprecated",["addRewriter","addFilter","clone","extend"]),s.forProperties(t,"deprecated",["emitErrs","levelLength"]),s.moved(t,"createLogger","Logger")},2850:(e,t,r)=>{"use strict";const{format:n}=r(3837);t.warn={deprecated:e=>()=>{throw new Error(n("{ %s } was removed in winston@3.0.0.",e))},useFormat:e=>()=>{throw new Error([n("{ %s } was removed in winston@3.0.0.",e),"Use a custom winston.format = winston.format(function) instead."].join("\n"))},forFunctions(e,r,n){n.forEach((n=>{e[n]=t.warn[r](n)}))},moved(e,t,r){function s(){return()=>{throw new Error([n("winston.%s was moved in winston@3.0.0.",r),n("Use a winston.%s instead.",t)].join("\n"))}}Object.defineProperty(e,r,{get:s,set:s})},forProperties(e,r,n){n.forEach((n=>{const s=t.warn[r](n);Object.defineProperty(e,n,{get:s,set:s})}))}}},448:(e,t,r)=>{"use strict";const n=r(562),{configs:s}=r(5396);t.cli=n.levels(s.cli),t.npm=n.levels(s.npm),t.syslog=n.levels(s.syslog),t.addColors=n.levels},6099:(e,t,r)=>{"use strict";const n=r(5658);e.exports=class{constructor(e={}){this.loggers=new Map,this.options=e}add(e,t){if(!this.loggers.has(e)){const r=(t=Object.assign({},t||this.options)).transports||this.options.transports;t.transports=r?r.slice():[];const s=n(t);s.on("close",(()=>this._delete(e))),this.loggers.set(e,s)}return this.loggers.get(e)}get(e,t){return this.add(e,t)}has(e){return!!this.loggers.has(e)}close(e){if(e)return this._removeLogger(e);this.loggers.forEach(((e,t)=>this._removeLogger(t)))}_removeLogger(e){this.loggers.has(e)&&(this.loggers.get(e).close(),this._delete(e))}_delete(e){this.loggers.delete(e)}}},5658:(e,t,r)=>{"use strict";const{LEVEL:n}=r(5396),s=r(448),o=r(9848),i=r(3420)("winston:create-logger");e.exports=function(e={}){e.levels=e.levels||s.npm.levels;class t extends o{constructor(e){super(e)}}const r=new t(e);return Object.keys(e.levels).forEach((function(e){i('Define prototype method for "%s"',e),"log"!==e?(t.prototype[e]=function(...t){const s=this||r;if(1===t.length){const[o]=t,i=o&&o.message&&o||{message:o};return i.level=i[n]=e,s._addDefaultMeta(i),s.write(i),this||r}return 0===t.length?(s.log(e,""),s):s.log(e,...t)},t.prototype[function(e){return"is"+e.charAt(0).toUpperCase()+e.slice(1)+"Enabled"}(e)]=function(){return(this||r).isLevelEnabled(e)}):console.warn('Level "log" not defined: conflicts with the method "log". Use a different level name.')})),r}},5120:(e,t,r)=>{"use strict";const n=r(2037),s=r(8058),o=r(3420)("winston:exception"),i=r(3138),a=r(7911),c=r(5193);e.exports=class{constructor(e){if(!e)throw new Error("Logger is required to handle exceptions");this.logger=e,this.handlers=new Map}handle(...e){e.forEach((e=>{if(Array.isArray(e))return e.forEach((e=>this._addHandler(e)));this._addHandler(e)})),this.catcher||(this.catcher=this._uncaughtException.bind(this),process.on("uncaughtException",this.catcher))}unhandle(){this.catcher&&(process.removeListener("uncaughtException",this.catcher),this.catcher=!1,Array.from(this.handlers.values()).forEach((e=>this.logger.unpipe(e))))}getAllInfo(e){let{message:t}=e;return t||"string"!=typeof e||(t=e),{error:e,level:"error",message:[`uncaughtException: ${t||"(no error message)"}`,e.stack||"  No stack trace"].join("\n"),stack:e.stack,exception:!0,date:(new Date).toString(),process:this.getProcessInfo(),os:this.getOsInfo(),trace:this.getTrace(e)}}getProcessInfo(){return{pid:process.pid,uid:process.getuid?process.getuid():null,gid:process.getgid?process.getgid():null,cwd:process.cwd(),execPath:process.execPath,version:process.version,argv:process.argv,memoryUsage:process.memoryUsage()}}getOsInfo(){return{loadavg:n.loadavg(),uptime:n.uptime()}}getTrace(e){return(e?a.parse(e):a.get()).map((e=>({column:e.getColumnNumber(),file:e.getFileName(),function:e.getFunctionName(),line:e.getLineNumber(),method:e.getMethodName(),native:e.isNative()})))}_addHandler(e){if(!this.handlers.has(e)){e.handleExceptions=!0;const t=new c(e);this.handlers.set(e,t),this.logger.pipe(t)}}_uncaughtException(e){const t=this.getAllInfo(e),r=this._getExceptionHandlers();let n,a="function"==typeof this.logger.exitOnError?this.logger.exitOnError(e):this.logger.exitOnError;function c(){o("doExit",a),o("process._exiting",process._exiting),a&&!process._exiting&&(n&&clearTimeout(n),process.exit(1))}if(!r.length&&a&&(console.warn("winston: exitOnError cannot be true with no exception handlers."),console.warn("winston: not exiting process."),a=!1),!r||0===r.length)return process.nextTick(c);s(r,((e,t)=>{const r=i(t),n=e.transport||e;function s(e){return()=>{o(e),r()}}n._ending=!0,n.once("finish",s("finished")),n.once("error",s("error"))}),(()=>a&&c())),this.logger.log(t),a&&(n=setTimeout(c,3e3))}_getExceptionHandlers(){return this.logger.transports.filter((e=>(e.transport||e).handleExceptions))}}},5193:(e,t,r)=>{"use strict";const{Writable:n}=r(1451);e.exports=class extends n{constructor(e){if(super({objectMode:!0}),!e)throw new Error("ExceptionStream requires a TransportStream instance.");this.handleExceptions=!0,this.transport=e}_write(e,t,r){return e.exception?this.transport.log(e,r):(r(),!0)}}},9848:(e,t,r)=>{"use strict";const{Stream:n,Transform:s}=r(1451),o=r(8058),{LEVEL:i,SPLAT:a}=r(5396),c=r(4970),l=r(5120),u=r(5724),d=r(4201),h=r(46),{warn:f}=r(2850),p=r(448),g=/%[scdjifoO%]/g;class m extends s{constructor(e){super({objectMode:!0}),this.configure(e)}child(e){const t=this;return Object.create(t,{write:{value:function(r){const n=Object.assign({},e,r);r instanceof Error&&(n.stack=r.stack,n.message=r.message),t.write(n)}}})}configure({silent:e,format:t,defaultMeta:n,levels:s,level:o="info",exitOnError:i=!0,transports:a,colors:c,emitErrs:d,formatters:h,padLevels:f,rewriters:g,stripColors:m,exceptionHandlers:y,rejectionHandlers:E}={}){if(this.transports.length&&this.clear(),this.silent=e,this.format=t||this.format||r(3922)(),this.defaultMeta=n||null,this.levels=s||this.levels||p.npm.levels,this.level=o,this.exceptions&&this.exceptions.unhandle(),this.rejections&&this.rejections.unhandle(),this.exceptions=new l(this),this.rejections=new u(this),this.profilers={},this.exitOnError=i,a&&(a=Array.isArray(a)?a:[a]).forEach((e=>this.add(e))),c||d||h||f||g||m)throw new Error(["{ colors, emitErrs, formatters, padLevels, rewriters, stripColors } were removed in winston@3.0.0.","Use a custom winston.format(function) instead.","See: https://github.com/winstonjs/winston/tree/master/UPGRADE-3.0.md"].join("\n"));y&&this.exceptions.handle(y),E&&this.rejections.handle(E)}isLevelEnabled(e){const t=y(this.levels,e);if(null===t)return!1;const r=y(this.levels,this.level);return null!==r&&(this.transports&&0!==this.transports.length?-1!==this.transports.findIndex((e=>{let n=y(this.levels,e.level);return null===n&&(n=r),n>=t})):r>=t)}log(e,t,...r){if(1===arguments.length)return e[i]=e.level,this._addDefaultMeta(e),this.write(e),this;if(2===arguments.length)return t&&"object"==typeof t?(t[i]=t.level=e,this._addDefaultMeta(t),this.write(t),this):(t={[i]:e,level:e,message:t},this._addDefaultMeta(t),this.write(t),this);const[n]=r;if("object"==typeof n&&null!==n&&!(t&&t.match&&t.match(g))){const s=Object.assign({},this.defaultMeta,n,{[i]:e,[a]:r,level:e,message:t});return n.message&&(s.message=`${s.message} ${n.message}`),n.stack&&(s.stack=n.stack),this.write(s),this}return this.write(Object.assign({},this.defaultMeta,{[i]:e,[a]:r,level:e,message:t})),this}_transform(e,t,r){if(this.silent)return r();e[i]||(e[i]=e.level),this.levels[e[i]]||0===this.levels[e[i]]||console.error("[winston] Unknown logger level: %s",e[i]),this._readableState.pipes||console.error("[winston] Attempt to write logs with no transports, which can increase memory usage: %j",e);try{this.push(this.format.transform(e,this.format.options))}finally{this._writableState.sync=!1,r()}}_final(e){const t=this.transports.slice();o(t,((e,t)=>{if(!e||e.finished)return setImmediate(t);e.once("finish",t),e.end()}),e)}add(e){const t=!c(e)||e.log.length>2?new d({transport:e}):e;if(!t._writableState||!t._writableState.objectMode)throw new Error("Transports must WritableStreams in objectMode. Set { objectMode: true }.");return this._onEvent("error",t),this._onEvent("warn",t),this.pipe(t),e.handleExceptions&&this.exceptions.handle(),e.handleRejections&&this.rejections.handle(),this}remove(e){if(!e)return this;let t=e;return(!c(e)||e.log.length>2)&&(t=this.transports.filter((t=>t.transport===e))[0]),t&&this.unpipe(t),this}clear(){return this.unpipe(),this}close(){return this.exceptions.unhandle(),this.rejections.unhandle(),this.clear(),this.emit("close"),this}setLevels(){f.deprecated("setLevels")}query(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const r={},n=Object.assign({},e.query||{});o(this.transports.filter((e=>!!e.query)),(function(t,s){!function(t,r){e.query&&"function"==typeof t.formatQuery&&(e.query=t.formatQuery(n)),t.query(e,((n,s)=>{if(n)return r(n);"function"==typeof t.formatResults&&(s=t.formatResults(s,e.format)),r(null,s)}))}(t,((e,n)=>{s&&((n=e||n)&&(r[t.name]=n),s()),s=null}))}),(()=>t(null,r)))}stream(e={}){const t=new n,r=[];return t._streams=r,t.destroy=()=>{let e=r.length;for(;e--;)r[e].destroy()},this.transports.filter((e=>!!e.stream)).forEach((n=>{const s=n.stream(e);s&&(r.push(s),s.on("log",(e=>{e.transport=e.transport||[],e.transport.push(n.name),t.emit("log",e)})),s.on("error",(e=>{e.transport=e.transport||[],e.transport.push(n.name),t.emit("error",e)})))})),t}startTimer(){return new h(this)}profile(e,...t){const r=Date.now();if(this.profilers[e]){const n=this.profilers[e];delete this.profilers[e],"function"==typeof t[t.length-2]&&(console.warn("Callback function no longer supported as of winston@3.0.0"),t.pop());const s="object"==typeof t[t.length-1]?t.pop():{};return s.level=s.level||"info",s.durationMs=r-n,s.message=s.message||e,this.write(s)}return this.profilers[e]=r,this}handleExceptions(...e){console.warn("Deprecated: .handleExceptions() will be removed in winston@4. Use .exceptions.handle()"),this.exceptions.handle(...e)}unhandleExceptions(...e){console.warn("Deprecated: .unhandleExceptions() will be removed in winston@4. Use .exceptions.unhandle()"),this.exceptions.unhandle(...e)}cli(){throw new Error(["Logger.cli() was removed in winston@3.0.0","Use a custom winston.formats.cli() instead.","See: https://github.com/winstonjs/winston/tree/master/UPGRADE-3.0.md"].join("\n"))}_onEvent(e,t){t["__winston"+e]||(t["__winston"+e]=function(r){"error"!==e||this.transports.includes(t)||this.add(t),this.emit(e,r,t)}.bind(this),t.on(e,t["__winston"+e]))}_addDefaultMeta(e){this.defaultMeta&&Object.assign(e,this.defaultMeta)}}function y(e,t){const r=e[t];return r||0===r?r:null}Object.defineProperty(m.prototype,"transports",{configurable:!1,enumerable:!0,get(){const{pipes:e}=this._readableState;return Array.isArray(e)?e:[e].filter(Boolean)}}),e.exports=m},46:e=>{"use strict";e.exports=class{constructor(e){if(!e)throw new Error("Logger is required for profiling.");this.logger=e,this.start=Date.now()}done(...e){"function"==typeof e[e.length-1]&&(console.warn("Callback function no longer supported as of winston@3.0.0"),e.pop());const t="object"==typeof e[e.length-1]?e.pop():{};return t.level=t.level||"info",t.durationMs=Date.now()-this.start,this.logger.write(t)}}},5724:(e,t,r)=>{"use strict";const n=r(2037),s=r(8058),o=r(3420)("winston:rejection"),i=r(3138),a=r(7911),c=r(5193);e.exports=class{constructor(e){if(!e)throw new Error("Logger is required to handle rejections");this.logger=e,this.handlers=new Map}handle(...e){e.forEach((e=>{if(Array.isArray(e))return e.forEach((e=>this._addHandler(e)));this._addHandler(e)})),this.catcher||(this.catcher=this._unhandledRejection.bind(this),process.on("unhandledRejection",this.catcher))}unhandle(){this.catcher&&(process.removeListener("unhandledRejection",this.catcher),this.catcher=!1,Array.from(this.handlers.values()).forEach((e=>this.logger.unpipe(e))))}getAllInfo(e){let t=null;return e&&(t="string"==typeof e?e:e.message),{error:e,level:"error",message:[`unhandledRejection: ${t||"(no error message)"}`,e&&e.stack||"  No stack trace"].join("\n"),stack:e&&e.stack,exception:!0,date:(new Date).toString(),process:this.getProcessInfo(),os:this.getOsInfo(),trace:this.getTrace(e)}}getProcessInfo(){return{pid:process.pid,uid:process.getuid?process.getuid():null,gid:process.getgid?process.getgid():null,cwd:process.cwd(),execPath:process.execPath,version:process.version,argv:process.argv,memoryUsage:process.memoryUsage()}}getOsInfo(){return{loadavg:n.loadavg(),uptime:n.uptime()}}getTrace(e){return(e?a.parse(e):a.get()).map((e=>({column:e.getColumnNumber(),file:e.getFileName(),function:e.getFunctionName(),line:e.getLineNumber(),method:e.getMethodName(),native:e.isNative()})))}_addHandler(e){if(!this.handlers.has(e)){e.handleRejections=!0;const t=new c(e);this.handlers.set(e,t),this.logger.pipe(t)}}_unhandledRejection(e){const t=this.getAllInfo(e),r=this._getRejectionHandlers();let n,a="function"==typeof this.logger.exitOnError?this.logger.exitOnError(e):this.logger.exitOnError;function c(){o("doExit",a),o("process._exiting",process._exiting),a&&!process._exiting&&(n&&clearTimeout(n),process.exit(1))}if(!r.length&&a&&(console.warn("winston: exitOnError cannot be true with no rejection handlers."),console.warn("winston: not exiting process."),a=!1),!r||0===r.length)return process.nextTick(c);s(r,((e,t)=>{const r=i(t),n=e.transport||e;function s(e){return()=>{o(e),r()}}n._ending=!0,n.once("finish",s("finished")),n.once("error",s("error"))}),(()=>a&&c())),this.logger.log(t),a&&(n=setTimeout(c,3e3))}_getRejectionHandlers(){return this.logger.transports.filter((e=>(e.transport||e).handleRejections))}}},4778:(e,t,r)=>{"use strict";const n=r(7147),{StringDecoder:s}=r(1576),{Stream:o}=r(1451);function i(){}e.exports=(e,t)=>{const r=Buffer.alloc(65536),a=new s("utf8"),c=new o;let l="",u=0,d=0;return-1===e.start&&delete e.start,c.readable=!0,c.destroy=()=>{c.destroyed=!0,c.emit("end"),c.emit("close")},n.open(e.file,"a+","0644",((s,o)=>{if(s)return t?t(s):c.emit("error",s),void c.destroy();!function s(){if(!c.destroyed)return n.read(o,r,0,r.length,u,((n,o)=>{if(n)return t?t(n):c.emit("error",n),void c.destroy();if(!o)return l&&((null==e.start||d>e.start)&&(t?t(null,l):c.emit("line",l)),d++,l=""),setTimeout(s,1e3);let i=a.write(r.slice(0,o));t||c.emit("data",i),i=(l+i).split(/\n+/);const h=i.length-1;let f=0;for(;f<h;f++)(null==e.start||d>e.start)&&(t?t(null,i[f]):c.emit("line",i[f])),d++;return l=i[h],u+=o,s()}));n.close(o,i)}()})),t?c.destroy:c}},2158:(e,t,r)=>{"use strict";const n=r(2037),{LEVEL:s,MESSAGE:o}=r(5396),i=r(1037);e.exports=class extends i{constructor(e={}){super(e),this.name=e.name||"console",this.stderrLevels=this._stringArrayToSet(e.stderrLevels),this.consoleWarnLevels=this._stringArrayToSet(e.consoleWarnLevels),this.eol="string"==typeof e.eol?e.eol:n.EOL,this.setMaxListeners(30)}log(e,t){return setImmediate((()=>this.emit("logged",e))),this.stderrLevels[e[s]]?(console._stderr?console._stderr.write(`${e[o]}${this.eol}`):console.error(e[o]),void(t&&t())):this.consoleWarnLevels[e[s]]?(console._stderr?console._stderr.write(`${e[o]}${this.eol}`):console.warn(e[o]),void(t&&t())):(console._stdout?console._stdout.write(`${e[o]}${this.eol}`):console.log(e[o]),void(t&&t()))}_stringArrayToSet(e,t){if(!e)return{};if(t=t||"Cannot make set from type other than Array of string elements",!Array.isArray(e))throw new Error(t);return e.reduce(((e,r)=>{if("string"!=typeof r)throw new Error(t);return e[r]=!0,e}),{})}}},9140:(e,t,r)=>{"use strict";const n=r(7147),s=r(1017),o=r(8415),i=r(9796),{MESSAGE:a}=r(5396),{Stream:c,PassThrough:l}=r(1451),u=r(1037),d=r(3420)("winston:file"),h=r(2037),f=r(4778);e.exports=class extends u{constructor(e={}){function t(t,...r){r.slice(1).forEach((r=>{if(e[r])throw new Error(`Cannot set ${r} and ${t} together`)}))}if(super(e),this.name=e.name||"file",this._stream=new l,this._stream.setMaxListeners(30),this._onError=this._onError.bind(this),e.filename||e.dirname)t("filename or dirname","stream"),this._basename=this.filename=e.filename?s.basename(e.filename):"winston.log",this.dirname=e.dirname||s.dirname(e.filename),this.options=e.options||{flags:"a"};else{if(!e.stream)throw new Error("Cannot log to file without filename or stream.");console.warn("options.stream will be removed in winston@4. Use winston.transports.Stream"),t("stream","filename","maxsize"),this._dest=this._stream.pipe(this._setupStream(e.stream)),this.dirname=s.dirname(this._dest.path)}this.maxsize=e.maxsize||null,this.rotationFormat=e.rotationFormat||!1,this.zippedArchive=e.zippedArchive||!1,this.maxFiles=e.maxFiles||null,this.eol="string"==typeof e.eol?e.eol:h.EOL,this.tailable=e.tailable||!1,this._size=0,this._pendingSize=0,this._created=0,this._drain=!1,this._opening=!1,this._ending=!1,this.dirname&&this._createLogDirIfNotExist(this.dirname),this.open()}finishIfEnding(){this._ending&&(this._opening?this.once("open",(()=>{this._stream.once("finish",(()=>this.emit("finish"))),setImmediate((()=>this._stream.end()))})):(this._stream.once("finish",(()=>this.emit("finish"))),setImmediate((()=>this._stream.end()))))}log(e,t=(()=>{})){if(this.silent)return t(),!0;if(this._drain)return void this._stream.once("drain",(()=>{this._drain=!1,this.log(e,t)}));if(this._rotate)return void this._stream.once("rotate",(()=>{this._rotate=!1,this.log(e,t)}));const r=`${e[a]}${this.eol}`,n=Buffer.byteLength(r);this._pendingSize+=n,this._opening&&!this.rotatedWhileOpening&&this._needsNewFile(this._size+this._pendingSize)&&(this.rotatedWhileOpening=!0);const s=this._stream.write(r,function(){this._size+=n,this._pendingSize-=n,d("logged %s %s",this._size,r),this.emit("logged",e),this._opening||this._needsNewFile()&&(this._rotate=!0,this._endStream((()=>this._rotateFile())))}.bind(this));return s?t():(this._drain=!0,this._stream.once("drain",(()=>{this._drain=!1,t()}))),d("written",s,this._drain),this.finishIfEnding(),s}query(e,t){"function"==typeof e&&(t=e,e={}),e=function(e){return(e=e||{}).rows=e.rows||e.limit||10,e.start=e.start||0,e.until=e.until||new Date,"object"!=typeof e.until&&(e.until=new Date(e.until)),e.from=e.from||e.until-864e5,"object"!=typeof e.from&&(e.from=new Date(e.from)),e.order=e.order||"desc",e}(e);const r=s.join(this.dirname,this.filename);let o="",i=[],a=0;const c=n.createReadStream(r,{encoding:"utf8"});function l(t,r){try{const r=JSON.parse(t);(function(t){if(!t)return;if("object"!=typeof t)return;const r=new Date(t.timestamp);return!(e.from&&r<e.from||e.until&&r>e.until||e.level&&e.level!==t.level)||void 0})(r)&&function(t){e.rows&&i.length>=e.rows&&"desc"!==e.order?c.readable&&c.destroy():(e.fields&&(t=e.fields.reduce(((e,r)=>(e[r]=t[r],e)),{})),"desc"===e.order&&i.length>=e.rows&&i.shift(),i.push(t))}(r)}catch(e){r||c.emit("error",e)}}c.on("error",(e=>{if(c.readable&&c.destroy(),t)return"ENOENT"!==e.code?t(e):t(null,i)})),c.on("data",(t=>{const r=(t=(o+t).split(/\n+/)).length-1;let n=0;for(;n<r;n++)(!e.start||a>=e.start)&&l(t[n]),a++;o=t[r]})),c.on("close",(()=>{o&&l(o,!0),"desc"===e.order&&(i=i.reverse()),t&&t(null,i)}))}stream(e={}){const t=s.join(this.dirname,this.filename),r=new c,n={file:t,start:e.start};return r.destroy=f(n,((e,t)=>{if(e)return r.emit("error",e);try{r.emit("data",t),t=JSON.parse(t),r.emit("log",t)}catch(e){r.emit("error",e)}})),r}open(){this.filename&&(this._opening||(this._opening=!0,this.stat(((e,t)=>{if(e)return this.emit("error",e);d("stat done: %s { size: %s }",this.filename,t),this._size=t,this._dest=this._createStream(this._stream),this._opening=!1,this.once("open",(()=>{this._stream.eventNames().includes("rotate")?this._stream.emit("rotate"):this._rotate=!1}))}))))}stat(e){const t=this._getFile(),r=s.join(this.dirname,t);n.stat(r,((n,s)=>n&&"ENOENT"===n.code?(d("ENOENT ok",r),this.filename=t,e(null,0)):n?(d(`err ${n.code} ${r}`),e(n)):!s||this._needsNewFile(s.size)?this._incFile((()=>this.stat(e))):(this.filename=t,void e(null,s.size))))}close(e){this._stream&&this._stream.end((()=>{e&&e(),this.emit("flush"),this.emit("closed")}))}_needsNewFile(e){return e=e||this._size,this.maxsize&&e>=this.maxsize}_onError(e){this.emit("error",e)}_setupStream(e){return e.on("error",this._onError),e}_cleanupStream(e){return e.removeListener("error",this._onError),e}_rotateFile(){this._incFile((()=>this.open()))}_endStream(e=(()=>{})){this._dest?(this._stream.unpipe(this._dest),this._dest.end((()=>{this._cleanupStream(this._dest),e()}))):e()}_createStream(e){const t=s.join(this.dirname,this.filename);d("create stream start",t,this.options);const r=n.createWriteStream(t,this.options).on("error",(e=>d(e))).on("close",(()=>d("close",r.path,r.bytesWritten))).on("open",(()=>{d("file open ok",t),this.emit("open",t),e.pipe(r),this.rotatedWhileOpening&&(this._stream=new l,this._stream.setMaxListeners(30),this._rotateFile(),this.rotatedWhileOpening=!1,this._cleanupStream(r),e.end())}));if(d("create stream ok",t),this.zippedArchive){const e=i.createGzip();return e.pipe(r),e}return r}_incFile(e){d("_incFile",this.filename);const t=s.extname(this._basename),r=s.basename(this._basename,t);this.tailable?this._checkMaxFilesTailable(t,r,e):(this._created+=1,this._checkMaxFilesIncrementing(t,r,e))}_getFile(){const e=s.extname(this._basename),t=s.basename(this._basename,e),r=this.rotationFormat?this.rotationFormat():this._created,n=!this.tailable&&this._created?`${t}${r}${e}`:`${t}${e}`;return this.zippedArchive&&!this.tailable?`${n}.gz`:n}_checkMaxFilesIncrementing(e,t,r){if(!this.maxFiles||this._created<this.maxFiles)return setImmediate(r);const o=this._created-this.maxFiles,i=`${t}${0!==o?o:""}${e}${this.zippedArchive?".gz":""}`,a=s.join(this.dirname,i);n.unlink(a,r)}_checkMaxFilesTailable(e,t,r){const i=[];if(!this.maxFiles)return;const a=this.zippedArchive?".gz":"";for(let r=this.maxFiles-1;r>1;r--)i.push(function(r,o){let i=`${t}${r-1}${e}${a}`;const c=s.join(this.dirname,i);n.exists(c,(l=>{if(!l)return o(null);i=`${t}${r}${e}${a}`,n.rename(c,s.join(this.dirname,i),o)}))}.bind(this,r));o(i,(()=>{n.rename(s.join(this.dirname,`${t}${e}`),s.join(this.dirname,`${t}1${e}${a}`),r)}))}_createLogDirIfNotExist(e){n.existsSync(e)||n.mkdirSync(e,{recursive:!0})}}},1734:(e,t,r)=>{"use strict";const n=r(3685),s=r(5687),{Stream:o}=r(1451),i=r(1037),a=r(7668);e.exports=class extends i{constructor(e={}){super(e),this.options=e,this.name=e.name||"http",this.ssl=!!e.ssl,this.host=e.host||"localhost",this.port=e.port,this.auth=e.auth,this.path=e.path||"",this.agent=e.agent,this.headers=e.headers||{},this.headers["content-type"]="application/json",this.batch=e.batch||!1,this.batchInterval=e.batchInterval||5e3,this.batchCount=e.batchCount||10,this.batchOptions=[],this.batchTimeoutID=-1,this.batchCallback={},this.port||(this.port=this.ssl?443:80)}log(e,t){this._request(e,((t,r)=>{r&&200!==r.statusCode&&(t=new Error(`Invalid HTTP Status Code: ${r.statusCode}`)),t?this.emit("warn",t):this.emit("logged",e)})),t&&setImmediate(t)}query(e,t){"function"==typeof e&&(t=e,e={}),(e={method:"query",params:this.normalizeQuery(e)}).params.path&&(e.path=e.params.path,delete e.params.path),e.params.auth&&(e.auth=e.params.auth,delete e.params.auth),this._request(e,((e,r,n)=>{if(r&&200!==r.statusCode&&(e=new Error(`Invalid HTTP Status Code: ${r.statusCode}`)),e)return t(e);if("string"==typeof n)try{n=JSON.parse(n)}catch(e){return t(e)}t(null,n)}))}stream(e={}){const t=new o;(e={method:"stream",params:e}).params.path&&(e.path=e.params.path,delete e.params.path),e.params.auth&&(e.auth=e.params.auth,delete e.params.auth);let r="";const n=this._request(e);return t.destroy=()=>n.destroy(),n.on("data",(e=>{const n=(e=(r+e).split(/\n+/)).length-1;let s=0;for(;s<n;s++)try{t.emit("log",JSON.parse(e[s]))}catch(e){t.emit("error",e)}r=e[n]})),n.on("error",(e=>t.emit("error",e))),t}_request(e,t){const r=(e=e||{}).auth||this.auth,n=e.path||this.path||"";delete e.auth,delete e.path,this.batch?this._doBatch(e,t,r,n):this._doRequest(e,t,r,n)}_doBatch(e,t,r,n){if(this.batchOptions.push(e),1===this.batchOptions.length){const e=this;this.batchCallback=t,this.batchTimeoutID=setTimeout((function(){e.batchTimeoutID=-1,e._doBatchRequest(e.batchCallback,r,n)}),this.batchInterval)}this.batchOptions.length===this.batchCount&&this._doBatchRequest(this.batchCallback,r,n)}_doBatchRequest(e,t,r){this.batchTimeoutID>0&&(clearTimeout(this.batchTimeoutID),this.batchTimeoutID=-1);const n=this.batchOptions.slice();this.batchOptions=[],this._doRequest(n,e,t,r)}_doRequest(e,t,r,o){const i=Object.assign({},this.headers);r&&r.bearer&&(i.Authorization=`Bearer ${r.bearer}`);const c=(this.ssl?s:n).request({...this.options,method:"POST",host:this.host,port:this.port,path:`/${o.replace(/^\//,"")}`,headers:i,auth:r&&r.username&&r.password?`${r.username}:${r.password}`:"",agent:this.agent});c.on("error",t),c.on("response",(e=>e.on("end",(()=>t(null,e))).resume())),c.end(Buffer.from(a(e,this.options.replacer),"utf8"))}}},9840:(e,t,r)=>{"use strict";Object.defineProperty(t,"Console",{configurable:!0,enumerable:!0,get:()=>r(2158)}),Object.defineProperty(t,"File",{configurable:!0,enumerable:!0,get:()=>r(9140)}),Object.defineProperty(t,"Http",{configurable:!0,enumerable:!0,get:()=>r(1734)}),Object.defineProperty(t,"Stream",{configurable:!0,enumerable:!0,get:()=>r(4635)})},4635:(e,t,r)=>{"use strict";const n=r(4970),{MESSAGE:s}=r(5396),o=r(2037),i=r(1037);e.exports=class extends i{constructor(e={}){if(super(e),!e.stream||!n(e.stream))throw new Error("options.stream is required.");this._stream=e.stream,this._stream.setMaxListeners(1/0),this.isObjectMode=e.stream._writableState.objectMode,this.eol="string"==typeof e.eol?e.eol:o.EOL}log(e,t){if(setImmediate((()=>this.emit("logged",e))),this.isObjectMode)return this._stream.write(e),void(t&&t());this._stream.write(`${e[s]}${this.eol}`),t&&t()}}},4300:e=>{"use strict";e.exports=require("buffer")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},1576:e=>{"use strict";e.exports=require("string_decoder")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},2561:e=>{"use strict";e.exports={version:"3.8.2"}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t,n,s;!function(e){e.OPEN_APP="phone:openApp",e.OPEN_PHONE="phone:open",e.CLOSE_PHONE="phone:close",e.UNLOAD_CHARACTER="phone:unloadCharacter",e.SET_AVAILABILITY="phone:setAvailability",e.SET_VISIBILITY="phone:setVisibility",e.ADD_SNACKBAR_ALERT="phone:setSnackarAlert",e.SET_NUMBER="phone:setNumber",e.SET_SOCIETY_NUMBER="phone:setSocietyNumber",e.SET_PHONE_READY="phone:phoneReady",e.SET_CONFIG="phone:setPhoneConfig",e.SET_TIME="phone:setGameTime",e.SEND_CREDENTIALS="phone:sendCredentials",e.FETCH_CREDENTIALS="phone:getCredentials",e.TOGGLE_KEYS="phone:toggleAllControls",e.SET_PLAYER_LOADED="phone:setPlayerLoaded"}(e||(e={})),function(e){e.SERVER_ERROR="GENERAL_SERVER_ERROR",e.DELETE_FAILED="DELETE_FAILED",e.ADD_FAILED="ADD_FAILED",e.UPDATE_FAILED="UPDATED_FAILED",e.FETCH_FAILED="FETCH_FAILED"}(t||(t={})),function(e){e[e.message=255]="message"}(n||(n={})),function(e){e.UPDATE_SOCIETY_MESSAGE="phone:updateSocietyMessage",e.UPDATE_SOCIETY_MESSAGE_SUCCESS="phone:updateSocietyMessageSuccess",e.SEND_SOCIETY_MESSAGE="phone:sendSocietyMessage",e.FETCH_SOCIETY_MESSAGES="phone:fetchSocietyMessage",e.RESET_SOCIETY_MESSAGES="phone:resetSocietyMessage",e.SEND_SOCIETY_MESSAGE_SUCCESS="phone:sendSocietyMessageSuccess",e.CREATE_MESSAGE_BROADCAST="phone:createSocietyMessagesBroadcast"}(s||(s={}));const o={fbi:"555-FBI",lspd:"555-LSPD",lsmc:"555-LSMC",bcso:"555-BCSO",news:"555-NEWS",garbage:"555-BLUEBIRD",taxi:"555-CARLJR",food:"555-MARIUS",oil:"555-MTP","cash-transfer":"555-STONK",bennys:"555-NEWGAHRAY",upw:"555-UPW",pawl:"555-PAWL",baun:"555-BAUN",ffs:"555-FFS",mdr:"555-MDR"},i=()=>global.source,a=(e,t)=>onNet(e,t),c=(e,t,r)=>{if(r)return emitNet(e,r,t);emitNet(e,t)};var l=Object.defineProperty,u=class extends Map{ensure(e,t){if(this.has(e))return this.get(e);const r=t(e,this);return this.set(e,r),r}hasAll(...e){return e.every((e=>super.has(e)))}hasAny(...e){return e.some((e=>super.has(e)))}first(e){if(void 0===e)return this.values().next().value;if(e<0)return this.last(-1*e);e=Math.min(this.size,e);const t=this.values();return Array.from({length:e},(()=>t.next().value))}firstKey(e){if(void 0===e)return this.keys().next().value;if(e<0)return this.lastKey(-1*e);e=Math.min(this.size,e);const t=this.keys();return Array.from({length:e},(()=>t.next().value))}last(e){const t=[...this.values()];return void 0===e?t[t.length-1]:e<0?this.first(-1*e):e?t.slice(-e):[]}lastKey(e){const t=[...this.keys()];return void 0===e?t[t.length-1]:e<0?this.firstKey(-1*e):e?t.slice(-e):[]}at(e){return e=Math.floor(e),[...this.values()].at(e)}keyAt(e){return e=Math.floor(e),[...this.keys()].at(e)}random(e){const t=[...this.values()];return void 0===e?t[Math.floor(Math.random()*t.length)]:t.length&&e?Array.from({length:Math.min(e,t.length)},(()=>t.splice(Math.floor(Math.random()*t.length),1)[0])):[]}randomKey(e){const t=[...this.keys()];return void 0===e?t[Math.floor(Math.random()*t.length)]:t.length&&e?Array.from({length:Math.min(e,t.length)},(()=>t.splice(Math.floor(Math.random()*t.length),1)[0])):[]}reverse(){const e=[...this.entries()].reverse();this.clear();for(const[t,r]of e)this.set(t,r);return this}find(e,t){void 0!==t&&(e=e.bind(t));for(const[t,r]of this)if(e(r,t,this))return r}findKey(e,t){void 0!==t&&(e=e.bind(t));for(const[t,r]of this)if(e(r,t,this))return t}sweep(e,t){void 0!==t&&(e=e.bind(t));const r=this.size;for(const[t,r]of this)e(r,t,this)&&this.delete(t);return r-this.size}filter(e,t){void 0!==t&&(e=e.bind(t));const r=new this.constructor[Symbol.species];for(const[t,n]of this)e(n,t,this)&&r.set(t,n);return r}partition(e,t){void 0!==t&&(e=e.bind(t));const r=[new this.constructor[Symbol.species],new this.constructor[Symbol.species]];for(const[t,n]of this)e(n,t,this)?r[0].set(t,n):r[1].set(t,n);return r}flatMap(e,t){const r=this.map(e,t);return(new this.constructor[Symbol.species]).concat(...r)}map(e,t){void 0!==t&&(e=e.bind(t));const r=this.entries();return Array.from({length:this.size},(()=>{const[t,n]=r.next().value;return e(n,t,this)}))}mapValues(e,t){void 0!==t&&(e=e.bind(t));const r=new this.constructor[Symbol.species];for(const[t,n]of this)r.set(t,e(n,t,this));return r}some(e,t){void 0!==t&&(e=e.bind(t));for(const[t,r]of this)if(e(r,t,this))return!0;return!1}every(e,t){void 0!==t&&(e=e.bind(t));for(const[t,r]of this)if(!e(r,t,this))return!1;return!0}reduce(e,t){let r;if(void 0!==t){r=t;for(const[t,n]of this)r=e(r,n,t,this);return r}let n=!0;for(const[t,s]of this)n?(r=s,n=!1):r=e(r,s,t,this);if(n)throw new TypeError("Reduce of empty collection with no initial value");return r}each(e,t){return this.forEach(e,t),this}tap(e,t){return void 0!==t&&(e=e.bind(t)),e(this),this}clone(){return new this.constructor[Symbol.species](this)}concat(...e){const t=this.clone();for(const r of e)for(const[e,n]of r)t.set(e,n);return t}equals(e){if(!e)return!1;if(this===e)return!0;if(this.size!==e.size)return!1;for(const[t,r]of this)if(!e.has(t)||r!==e.get(t))return!1;return!0}sort(e=u.defaultSort){const t=[...this.entries()];t.sort(((t,r)=>e(t[1],r[1],t[0],r[0]))),super.clear();for(const[e,r]of t)super.set(e,r);return this}intersect(e){const t=new this.constructor[Symbol.species];for(const[r,n]of e)this.has(r)&&Object.is(n,this.get(r))&&t.set(r,n);return t}difference(e){const t=new this.constructor[Symbol.species];for(const[r,n]of e)this.has(r)||t.set(r,n);for(const[r,n]of this)e.has(r)||t.set(r,n);return t}merge(e,t,r,n){const s=new this.constructor[Symbol.species],o=new Set([...this.keys(),...e.keys()]);for(const i of o){const o=this.has(i),a=e.has(i);if(o&&a){const t=n(this.get(i),e.get(i),i);t.keep&&s.set(i,t.value)}else if(o){const e=t(this.get(i),i);e.keep&&s.set(i,e.value)}else if(a){const t=r(e.get(i),i);t.keep&&s.set(i,t.value)}}return s}sorted(e=u.defaultSort){return new this.constructor[Symbol.species](this).sort(((t,r,n,s)=>e(t,r,n,s)))}toJSON(){return[...this.values()]}static defaultSort(e,t){return Number(e>t)||Number(e===t)-1}static combineEntries(e,t){const r=new u;for(const[n,s]of e)r.has(n)?r.set(n,t(r.get(n),s,n)):r.set(n,s);return r}},d=u;l(d,"name",{value:"Collection",configurable:!0}),((e,t,r)=>{t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(d,"default"+"",u);var h=d;function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class p{getIdentifier(){return this._identifier}setIdentifier(e){return this._identifier=e,this}getFirstName(){return this._firstname}setFirstName(e){return this._firstname=e,this}getLastName(){return this._lastname}setLastName(e){return this._lastname=e,this}getName(){return this._firstname&&this._lastname?`${this._firstname} ${this._lastname}`:null}getPhoneNumber(){return this._phoneNumber}setPhoneNumber(e){return this._phoneNumber=e,this}getSocietyPhoneNumber(){return this._societyPhoneNumber}setSocietyPhoneNumber(e){return this._societyPhoneNumber=e,this}constructor({source:e,identifier:t,phoneNumber:r,username:n}){f(this,"source",void 0),f(this,"username",void 0),f(this,"_phoneNumber",void 0),f(this,"_societyPhoneNumber",void 0),f(this,"_identifier",void 0),f(this,"_firstname",void 0),f(this,"_lastname",void 0),this.source=e,this._identifier=t,this._phoneNumber=r,this.username=n}}const g=new class{async fetchIdentifierFromPhoneNumber(e){return(await exports.oxmysql.single_async("SELECT citizenid FROM player WHERE charinfo LIKE ?",["%"+e+"%"])).citizenid||null}};var m=r(1440),y=r.n(m);const E=y().createLogger({level:"info",transports:[new(y().transports.Console)({format:y().format.combine(y().format.label({label:"[Phone]"}),y().format.colorize({all:!0}),y().format.printf((e=>{return e.module?`${e.label} ${t=e.module,`[[35m${t}[0m]`} [${e.level}]: ${e.message}`:`${e.label} [${e.level}]: ${e.message}`;var t})))})]}),_=E.child({module:"player"});function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const v=new class{addPlayerToMaps(e,t){this.playersBySource.set(e,t),this.playersByIdentifier.set(t.getIdentifier(),t)}deletePlayerFromMaps(e){const t=this.playersBySource.get(e).getIdentifier();this.playersByIdentifier.delete(t),this.playersBySource.delete(e)}getPlayer(e){return this.playersBySource.get(e)||null}getIdentifier(e){return this.getPlayer(e).getIdentifier()}getPlayerFromIdentifier(e){return this.playersByIdentifier.get(e)||null}async getIdentifierFromPhoneNumber(e,t){const r=this.playersBySource.find((t=>t.getPhoneNumber()===e));return r?r.getIdentifier():t?await this.playerDB.fetchIdentifierFromPhoneNumber(e).catch((t=>(_.error(`Failed to fetch identifier from phone number for ${e}, error: ${t.message}`),null))):null}async handleNewPlayerJoined(t){const r=`${t.PlayerData.charinfo.firstname} ${t.PlayerData.charinfo.lastname}`;_.info(`Started loading for ${r} (${t.PlayerData.source})`);const n=new p({identifier:t.PlayerData.citizenid,source:t.PlayerData.source,username:r,phoneNumber:t.PlayerData.charinfo.phone});this.addPlayerToMaps(t.PlayerData.source,n),await this.handlePlayerJobUpdate(t.PlayerData.source,t.PlayerData.job),_.info("Player Loaded!"),_.debug(n),emitNet(e.SET_PLAYER_LOADED,t.PlayerData.source,!0)}async handlePlayerJobUpdate(e,t){const r=v.getPlayer(e),n=t.id;void 0!==o[n]?r.setSocietyPhoneNumber(o[n]):r.setSocietyPhoneNumber(null)}async createNewPlayer({src:e,identifier:t,phoneNumber:r}){const n=GetPlayerName(e.toString());return new p({source:e,identifier:t,phoneNumber:r,username:n})}async handleNewPlayerEvent({source:t,identifier:r,phoneNumber:n,firstname:s,lastname:o}){const i=await this.createNewPlayer({src:t,identifier:r.toString(),phoneNumber:n});s&&i.setFirstName(s),o&&i.setLastName(o),this.addPlayerToMaps(t,i),_.info(`New Player added through event (${t}) (${r})`),_.debug(i),emitNet(e.SET_PLAYER_LOADED,t,!0)}async getIdentifierByPhoneNumber(e,t){for(const[t,r]of this.playersBySource)if(r.getPhoneNumber()===e)return r.getIdentifier();if(t)return await this.playerDB.fetchIdentifierFromPhoneNumber(e)}async getPlayersFromSocietyNumber(e){const t=[];for(const[r,n]of this.playersBySource)n.getSocietyPhoneNumber()===e&&t.push(n);return t}async getPlayersFromNumber(e){for(const[t,r]of this.playersBySource)if(r.getPhoneNumber()===e)return r;return null}async handleUnloadPlayerEvent(t){this.deletePlayerFromMaps(t),emitNet(e.SET_PLAYER_LOADED,t,!1),_.info(`Unloaded Player, source: (${t})`)}constructor(){b(this,"playersBySource",void 0),b(this,"playersByIdentifier",void 0),b(this,"playerDB",void 0),this.playersBySource=new h,this.playersByIdentifier=new h,this.playerDB=g,_.debug("Player Service started")}},S=v;var w,T;onNet(e.FETCH_CREDENTIALS,(()=>{const t=i(),r=S.getPlayer(t),n=r.getPhoneNumber(),s=r.getSocietyPhoneNumber();emitNet(e.SEND_CREDENTIALS,t,n,s)})),on("QBCore:Server:PlayerLoaded",(async e=>{await S.handleNewPlayerJoined(e)})),on("QBCore:Server:OnJobUpdate",(async(e,t)=>{await S.handlePlayerJobUpdate(e,t),emitNet(s.RESET_SOCIETY_MESSAGES,e)})),on("QBCore:Server:PlayerUnload",(async e=>{try{await S.handleUnloadPlayerEvent(e)}catch(t){_.debug(`${e} failed to unload, likely was never loaded in the first place.`)}})),on("onServerResourceStart",(async e=>{if(e===GetCurrentResourceName()){let e=global.exports["qb-core"].GetCoreObject().Functions.GetQBPlayers();Array.isArray(e)||(e=Object.values(e));for(const t of e)await S.handleNewPlayerJoined(t)}})),function(e){e[e.DECLINED=0]="DECLINED",e[e.BUSY_LINE=1]="BUSY_LINE"}(w||(w={})),function(e){e.INITIALIZE_CALL="phone:beginCall",e.START_CALL="phone:startCall",e.ACCEPT_CALL="phone:acceptCall",e.END_CALL="phone:endCall",e.WAS_ENDED="phone:callEnded",e.WAS_ACCEPTED="phone:callAccepted",e.REJECTED="phone:rejectCall",e.WAS_REJECTED="phone:callRejected",e.SET_CALLER="phone:setCaller",e.SET_CALL_MODAL="phone:callModal",e.SEND_ALERT="phone:callSetAlert",e.FETCH_CALLS="phone:dialer:fetchCalls",e.ADD_CALL="phone:dialer:addCall",e.UPDATE_CALL="phone:dialer:updateCall",e.MUTE_PLAYER_CALL="phone:mutePlayer"}(T||(T={}));const R=E.child({module:"events"});function N(e,t){onNet(e,(async(r,n)=>{const s=process.hrtime.bigint(),o=i();if(!r)return R.warn(`Promise event (${e}) was called with wrong struct by ${o} (maybe originator wasn't a promiseEvent`);const a={source:o,data:n};R.silly(`netPromise > ${e} > RequestObj`),R.silly(a);const c=e=>{const t=process.hrtime.bigint(),n=Number(t-s)/1e6;emitNet(r,o,e),R.silly(`Response Promise Event ${r} (${n}ms), Data >>`),R.silly(e)};Promise.resolve(t(a,c)).catch((t=>{R.error(`An error occured for a onNetPromise (${e}), Error: ${t.message}`),c({status:"error",errorMsg:"UNKNOWN_ERROR"})}))}))}const A=require("crypto");var O=r.n(A);const M=new Uint8Array(256);let C=M.length;function D(){return C>M.length-16&&(O().randomFillSync(M),C=0),M.slice(C,C+=16)}const P=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,x=[];for(let e=0;e<256;++e)x.push((e+256).toString(16).substr(1));const L=function(e,t=0){const r=(x[e[t+0]]+x[e[t+1]]+x[e[t+2]]+x[e[t+3]]+"-"+x[e[t+4]]+x[e[t+5]]+"-"+x[e[t+6]]+x[e[t+7]]+"-"+x[e[t+8]]+x[e[t+9]]+"-"+x[e[t+10]]+x[e[t+11]]+x[e[t+12]]+x[e[t+13]]+x[e[t+14]]+x[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&P.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r},I=function(e,t,r){const n=(e=e||{}).random||(e.rng||D)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return L(n)};var $;!function(e){e[e.NOTES_FETCH_LIMIT=20]="NOTES_FETCH_LIMIT",e[e.CALLS_FETCH_LIMIT=50]="CALLS_FETCH_LIMIT",e[e.CONTACTS_FETCH_LIMIT=20]="CONTACTS_FETCH_LIMIT"}($||($={}));const j=new class{async saveCall(e){await exports.oxmysql.insert_async("INSERT INTO phone_calls (identifier, transmitter, receiver) VALUES (?, ?, ?)",[e.identifier,e.transmitter,e.receiver])}async updateCall(e,t){await exports.oxmysql.update_async("UPDATE phone_calls SET is_accepted=?, end=current_timestamp() WHERE identifier = ?",[t,e.identifier])}async fetchCalls(e,t=$.CALLS_FETCH_LIMIT){return await exports.oxmysql.query_async("SELECT *, unix_timestamp(start)*1000 as start, unix_timestamp(end)*1000 as end FROM phone_calls WHERE receiver = ? OR transmitter = ? ORDER BY start DESC LIMIT ?",[e,e,t])}},k=E.child({module:"calls"});function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const B=new class{setCallInMap(e,t){this.callMap.set(e,t),k.debug(`Call obj set with key ${e}, value:`),k.debug(t)}async handleInitializeCall(e,t){const r=S.getPlayer(e.source),n=r.getPhoneNumber(),s=await S.getIdentifierFromPhoneNumber(e.data.receiverNumber,!0);if(!s)return t({status:"error",data:{transmitter:n,isTransmitter:!0,receiver:e.data.receiverNumber,isUnavailable:!0,is_accepted:!1}});const o=I(),i=S.getPlayerFromIdentifier(s),a={identifier:o,transmitter:n,transmitterSource:r.source,receiver:e.data.receiverNumber,receiverSource:i?.source||0,start:(new Date).getTime()/1e3,end:(new Date).getTime()/1e3,is_accepted:!1};this.setCallInMap(a.transmitter,a);try{await this.callsDB.saveCall(a)}catch(e){k.error(`Unable to save call object for transmitter number ${n}. Error: ${e.toString()}`),t({status:"error",errorMsg:"DATABASE_ERROR"})}if(!i)return emitNet(T.ADD_CALL,e.source,{is_accepted:!1,transmitter:n,receiver:e.data.receiverNumber,isTransmitter:!0}),t({status:"ok",data:{is_accepted:!1,transmitter:n,isTransmitter:!0,receiver:e.data.receiverNumber,isUnavailable:!0}});t({status:"ok",data:{is_accepted:!1,transmitter:n,receiver:e.data.receiverNumber,isTransmitter:!0}}),c(T.START_CALL,{is_accepted:!1,transmitter:n,receiver:e.data.receiverNumber,isTransmitter:!1},i.source),emitNet(T.ADD_CALL,e.source,{is_accepted:!1,transmitter:n,receiver:e.data.receiverNumber,isTransmitter:!0}),emitNet(T.ADD_CALL,i.source,{is_accepted:!1,transmitter:n,receiver:e.data.receiverNumber,isTransmitter:!1})}async handleAcceptCall(e,t){const r=this.callMap.get(t);r.is_accepted=!0;const n=e;await this.callsDB.updateCall(r,!0),k.debug(`Call with key ${t} was updated to be accepted`),0!==r.receiverSource&&c(T.WAS_ACCEPTED,{is_accepted:!0,transmitter:t,receiver:r.receiver,isTransmitter:!1,channelId:n,startedAt:(new Date).getTime()/1e3},r.receiverSource),E.debug(r),c(T.WAS_ACCEPTED,{is_accepted:!0,transmitter:t,receiver:r.receiver,isTransmitter:!0,channelId:n,startedAt:(new Date).getTime()/1e3},r.transmitterSource),emitNet(T.UPDATE_CALL,r.receiverSource,{is_accepted:!0,transmitter:t,receiver:r.receiver,isTransmitter:!1,channelId:n,startedAt:(new Date).getTime()/1e3}),emitNet(T.UPDATE_CALL,r.transmitterSource,{is_accepted:!0,transmitter:t,receiver:r.receiver,isTransmitter:!0,channelId:n,startedAt:(new Date).getTime()/1e3})}async handleMuteCall(e,t){const r=this.callMap.get(t.transmitterNumber);emitNet("voip:client:call:setMute",t.isTransmitter?r.receiverSource:r.transmitterSource,t.muted)}async handleFetchCalls(e,t){const r=S.getPlayer(e.source).getPhoneNumber();try{t({status:"ok",data:await this.callsDB.fetchCalls(r)})}catch(e){t({status:"error",errorMsg:"DATABASE_ERROR"}),k.error(`Error while fetching calls, ${e.toString()}`)}}async handleRejectCall(e,t){const r=this.callMap.get(t);r?(emitNet(T.WAS_REJECTED,r.transmitterSource),emitNet(T.WAS_REJECTED,r.receiverSource),await this.callsDB.updateCall(r,!1),this.callMap.delete(t)):k.error(`Call with transmitter number ${t} does not exist in current calls map!`)}isPlayerAlreadyInCall(e){return void 0!==this.callMap.find((t=>(t.transmitter===e||t.receiver===e)&&t.is_accepted))}async handleEndCall(e,t){const r=e.data.transmitterNumber,n=this.callMap.get(r),s=this.callMap.get(n?.transmitter);if(!n)return k.error(`Call with transmitter number ${r} does not exist in current calls map!`),t({status:"error",errorMsg:"DOES_NOT_EXIST"});n&&(emitNet(T.WAS_ENDED,n.transmitterSource),(0!==n.receiverSource&&n?.identifier===s?.identifier&&n?.is_accepted||n?.identifier===s?.identifier&&!1===n?.is_accepted&&!this.isPlayerAlreadyInCall(s?.receiver))&&emitNet(T.WAS_ENDED,n.receiverSource)),t({status:"ok"}),await this.callsDB.updateCall(n,n?.is_accepted),this.callMap.delete(r)}constructor(){F(this,"callMap",void 0),F(this,"callsDB",void 0),this.callMap=new h,this.callsDB=j,k.debug("Call service started")}};var U;N(T.INITIALIZE_CALL,((e,t)=>{B.handleInitializeCall(e,t).catch((e=>{t({status:"error",errorMsg:"SERVER_ERROR"}),k.error(`Error occured handling init call: ${e.message}`)}))})),a(T.ACCEPT_CALL,(({transmitterNumber:e})=>{const t=i();B.handleAcceptCall(t,e).catch((t=>k.error(`Error occured in accept call event (${e}), Error:  ${t.message}`)))})),a(T.REJECTED,(e=>{const t=i();B.handleRejectCall(t,e.transmitterNumber).catch((t=>k.error(`Error occured in rejectcall event (${e.transmitterNumber}), Error:  ${t.message}`)))})),N(T.END_CALL,((e,t)=>{B.handleEndCall(e,t).catch((r=>{k.error(`Error occured in end call event (${e.data.transmitterNumber}), Error:  ${r.message}`),t({status:"error",errorMsg:"SERVER_ERROR"})}))})),a(T.MUTE_PLAYER_CALL,(e=>{const t=i();B.handleMuteCall(t,e).catch((t=>{k.error(`Error occured in mute call event (${e.transmitterNumber}), Error:  ${t.message}`)}))})),N(T.FETCH_CALLS,((e,t)=>{B.handleFetchCalls(e,t).catch((e=>{k.error(`Error occured in fetch call event, Error: ${e.message}`),t({status:"error",errorMsg:"SERVER_ERROR"})}))})),function(e){e.FETCH_ALL_NOTES="phone:app:notes:fetchAllNotes",e.ADD_NOTE="phone:app:notes:addNote",e.DELETE_NOTE="phone:app:notes:deleteNote",e.UPDATE_NOTE="phone:app:notes:updateNote"}(U||(U={}));const H=new class{async addNote(e,t){return await exports.oxmysql.insert_async("INSERT INTO phone_notes (identifier, title, content) VALUES (?, ?, ?)",[e,t.title,t.content])}async fetchNotes(e){return await exports.oxmysql.query_async("SELECT * FROM phone_notes WHERE identifier = ? ORDER BY id DESC",[e])}async deleteNote(e,t){await exports.oxmysql.query_async("DELETE FROM phone_notes WHERE id = ? AND identifier = ?",[e,t])}async updateNote(e,t){await exports.oxmysql.query_async("UPDATE phone_notes SET title = ?, content = ? WHERE id = ? AND identifier = ?",[e.title,e.content,e.id,t])}},q=E.child({module:"notes"}),G=new class{async handleFetchNotes(e,t){const r=S.getIdentifier(e.source);try{t({status:"ok",data:await this.notesDB.fetchNotes(r)})}catch(e){q.error(`Error in handleFetchNote, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async handleAddNote(e,t){q.debug("Handling add note, note:"),q.debug(e.data);const r=S.getIdentifier(e.source);try{const n=await this.notesDB.addNote(r,e.data);emitNet(U.ADD_NOTE,e.source,{id:n,title:e.data.title,content:e.data.content}),t({status:"ok",data:{id:n,content:e.data.content,title:e.data.title}})}catch(e){q.error(`Error in handleAddNote, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async handleUpdateNote(e,t){const r=S.getIdentifier(e.source);try{await this.notesDB.updateNote(e.data,r),emitNet(U.UPDATE_NOTE,e.source,e.data),t({status:"ok"})}catch(e){q.error(`Error in handleUpdateNote, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async handleDeleteNote(e,t){const r=S.getIdentifier(e.source);try{await this.notesDB.deleteNote(e.data.id,r),emitNet(U.DELETE_NOTE,e.source,e.data.id),t({status:"ok",data:e.data})}catch(e){q.error(`Error in handleDeleteNote, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}constructor(){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"notesDB",void 0),this.notesDB=H,q.debug("Notes service started")}},W=G;var Y,V;N(U.ADD_NOTE,((e,t)=>{W.handleAddNote(e,t).catch((r=>{q.error(`Error occured in add note event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"UNKNOWN_ERROR"})}))})),N(U.FETCH_ALL_NOTES,((e,t)=>{W.handleFetchNotes(e,t).catch((r=>{q.error(`Error occurred in fetch note event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"UNKNOWN_ERROR"})}))})),N(U.DELETE_NOTE,(async(e,t)=>{W.handleDeleteNote(e,t).catch((r=>{q.error(`Error occured in delete note event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"UNKNOWN_ERROR"})}))})),N(U.UPDATE_NOTE,(async(e,t)=>{W.handleUpdateNote(e,t).catch((r=>{q.error(`Error occured in fetch note event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"UNKNOWN_ERROR"})}))})),function(e){e[e.number=20]="number",e[e.display=255]="display"}(Y||(Y={})),function(e){e.GET_CONTACTS="phone:contact:get",e.ADD_CONTACT="phone:contact:add",e.ADD_CONTACT_SUCCESS="phone:contact:addSuccess",e.UPDATE_CONTACT="phone:contact:update",e.UPDATE_CONTACT_SUCCESS="phone:contact:updateSuccess",e.DELETE_CONTACT="phone:contact:delete",e.DELETE_CONTACT_SUCCESS="phone:contact:deleteSuccess"}(V||(V={}));const z=new class{async fetchAllContacts(e){return await exports.oxmysql.query_async("SELECT phone_contacts.*, phone_profile.avatar as avatar FROM phone_contacts LEFT JOIN phone_profile ON phone_contacts.number = phone_profile.number WHERE identifier = ? ORDER BY display ASC",[e])}async addContact(e,{display:t,number:r}){return{id:await exports.oxmysql.insert_async("INSERT INTO phone_contacts (identifier, number, display) VALUES (?, ?, ?)",[e,r,t]),number:r,display:t}}async updateContact(e,t){await exports.oxmysql.update_async("UPDATE phone_contacts SET number = ?, display = ? WHERE id = ? AND identifier = ?",[e.number,e.display,e.id,t])}async deleteContact(e,t){await exports.oxmysql.update_async("DELETE FROM phone_contacts WHERE id = ? AND identifier = ?",[e,t])}},J=E.child({module:"contact"}),K=new class{formatPhoneNumber(e){const t=e.match(/(555)-?(\d{4})/);return`${t[1]}-${t[2]}`}async handleUpdateContact(e,t){const r=S.getIdentifier(e.source);try{e.data.number=this.formatPhoneNumber(e.data.number),await this.contactsDB.updateContact(e.data,r),emitNet(V.UPDATE_CONTACT_SUCCESS,e.source,e.data),t({status:"ok"})}catch(e){J.error(`Error in handleUpdateContact (${r}), ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async handleDeleteContact(e,t){const r=S.getIdentifier(e.source);try{await this.contactsDB.deleteContact(e.data.id,r),emitNet(V.DELETE_CONTACT_SUCCESS,e.source,e.data.id),t({status:"ok"})}catch(e){t({status:"error",errorMsg:"DB_ERROR"}),J.error(`Error in handleDeleteContact (${r}), ${e.toString()}`)}}async handleAddContact(e,t){const r=S.getIdentifier(e.source);try{e.data.number=this.formatPhoneNumber(e.data.number);const n=await this.contactsDB.addContact(r,e.data);emitNet(V.ADD_CONTACT_SUCCESS,e.source,n),t({status:"ok",data:n})}catch(e){J.error(`Error in handleAddContact, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async handleFetchContacts(e,t){const r=S.getIdentifier(e.source);try{t({status:"ok",data:await this.contactsDB.fetchAllContacts(r)})}catch(e){t({status:"error",errorMsg:"DB_ERROR"}),J.error(`Error in handleFetchContact (${r}), ${e.toString()}`)}}constructor(){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"contactsDB",void 0),this.contactsDB=z,J.debug("Contacts service started")}},Z=K;var Q;N(V.GET_CONTACTS,((e,t)=>{Z.handleFetchContacts(e,t).catch((r=>{J.error(`Error occured in fetch contacts event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(V.ADD_CONTACT,((e,t)=>{Z.handleAddContact(e,t).catch((r=>{J.error(`Error occured in fetch contacts event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(V.UPDATE_CONTACT,((e,t)=>{Z.handleUpdateContact(e,t).catch((r=>{J.error(`Error occured in update contact event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(V.DELETE_CONTACT,((e,t)=>{Z.handleDeleteContact(e,t).catch((r=>{J.error(`Error occured in delete contact event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),function(e){e.ENTER_CAMERA="phone:camera:enter",e.TAKE_PHOTO="phone:camera:take",e.TOGGLE_CAMERA="phone:camera:toggle",e.EXIT_CAMERA="phone:camera:exit",e.CAMERA_EXITED="phone:cameraExited",e.TOGGLE_CONTROL_CAMERA="phone:camera:toggleControl",e.TAKE_PHOTO_SUCCESS="phone:TakePhotoSuccess",e.FETCH_PHOTOS="phone:photo:fetch",e.UPLOAD_PHOTO="phone:photo:upload",e.UPLOAD_PHOTO_SUCCESS="phone:photo:upload:success",e.DELETE_PHOTO="phone:photo:delete",e.DELETE_PHOTO_SUCCESS="phone:photo:delete:success"}(Q||(Q={}));const X=new class{async uploadPhoto(e,t){return{id:await exports.oxmysql.insert_async("INSERT INTO phone_gallery (identifier, image) VALUES (?, ?)",[e,t]),image:t}}async getPhotosByIdentifier(e){return await exports.oxmysql.query_async("SELECT id, image FROM phone_gallery WHERE identifier = ? ORDER BY id DESC",[e])}async deletePhoto(e,t){await exports.oxmysql.query_async("DELETE FROM phone_gallery WHERE image = ? AND identifier = ?",[e.image,t])}},ee=E.child({module:"photo"}),te=new class{async handleUploadPhoto(e,t){try{e.data||t({status:"error",errorMsg:"DB_ERROR"});const r=S.getIdentifier(e.source),n=await this.photoDB.uploadPhoto(r,e.data);emitNet(Q.UPLOAD_PHOTO_SUCCESS,e.source,n),t({status:"ok",data:n})}catch(r){ee.error(`Failed to upload photo, ${r.toString()}`,{source:e.source}),t({status:"error",errorMsg:"DB_ERROR"})}}async handleFetchPhotos(e,t){try{const r=S.getIdentifier(e.source);t({status:"ok",data:await this.photoDB.getPhotosByIdentifier(r)})}catch(r){ee.error(`Failed to fetch photos, ${r.toString()}`,{source:e.source}),t({status:"error",errorMsg:"DB_ERROR"})}}async handleDeletePhoto(e,t){try{const r=S.getIdentifier(e.source);await this.photoDB.deletePhoto(e.data,r),emitNet(Q.DELETE_PHOTO_SUCCESS,e.source,e.data),t({status:"ok"})}catch(r){ee.error(`Failed to delete photo, ${r.toString()}`,{source:e.source}),t({status:"error",errorMsg:"DB_ERROR"})}}constructor(){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"photoDB",void 0),this.photoDB=X,ee.debug("Photo service started")}},re=te;var ne;N(Q.UPLOAD_PHOTO,((e,t)=>{re.handleUploadPhoto(e,t).catch((r=>{ee.error(`Error occurred in upload photo event (${e.source}), Error: ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(Q.FETCH_PHOTOS,((e,t)=>{re.handleFetchPhotos(e,t).catch((r=>{ee.error(`Error occurred in upload photo event (${e.source}), Error: ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(Q.DELETE_PHOTO,((e,t)=>{re.handleDeletePhoto(e,t).catch((r=>{ee.error(`Error occurred in delete photo event (${e.source}), Error: ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),function(e){e.FETCH_MESSAGE_CONVERSATIONS="phone:fetchMessageGroups",e.FETCH_MESSAGE_GROUPS_SUCCESS="phone:fetchMessageGroupsSuccess",e.FETCH_MESSAGE_GROUPS_FAILED="phone:fetchMessageGroupsFailed",e.CREATE_MESSAGE_CONVERSATION="phone:createMessageGroup",e.CREATE_MESSAGE_CONVERSATION_SUCCESS="phone:createMessageConversationSuccess",e.UPDATE_MESSAGE_CONVERSATION_SUCCESS="phone:updateMessageConversationSuccess",e.CREATE_MESSAGE_GROUP_SUCCESS="phone:createMessageGroupSuccess",e.CREATE_MESSAGE_GROUP_FAILED="phone:createMessageGroupFailed",e.SEND_MESSAGE="phone:sendMessage",e.SEND_MESSAGE_SUCCESS="phone:sendMessageSuccess",e.SEND_MESSAGE_FAILED="phone:sendMessageFailed",e.FETCH_MESSAGES="phone:fetchMessages",e.FETCH_MESSAGES_SUCCESS="phone:fetchMessagesSuccess",e.FETCH_MESSAGES_FAILED="phone:fetchMessagesFailed",e.FETCH_INITIAL_MESSAGES="phone:fetchInitialMessages",e.ACTION_RESULT="phone:setMessagesAlert",e.CREATE_MESSAGE_BROADCAST="createMessagesBroadcast",e.SET_MESSAGE_READ="phone:setReadMessages",e.DELETE_CONVERSATION="phone:deleteConversation",e.GET_POSITION="phone:getCurrentPosition",e.GET_DESTINATION="phone:getCurrentDestination",e.SET_WAYPOINT="phone:setWaypoint",e.SET_CONVERSATION_ARCHIVED="phone:setConversationArchived"}(ne||(ne={}));const se=new class{async createMessage(e,t,r,n){const s=await exports.oxmysql.insert_async("INSERT INTO phone_messages (user_identifier, author, message, conversation_id) VALUES (?, ?, ?, ?)",[e,t,n,r]);return await exports.oxmysql.update_async("UPDATE phone_messages_conversations SET masked = 0, updatedAt = current_timestamp(), unread = unread + 1 WHERE conversation_id = ? AND participant_identifier = ?",[r,t]),s}async getMessageConversations(e){return await exports.oxmysql.query_async("SELECT DISTINCT phone_messages_conversations.unread,\n                             phone_messages_conversations.conversation_id,\n                             phone_messages_conversations.masked,\n                             phone_messages_conversations.user_identifier,\n                             phone_messages_conversations.participant_identifier,\n                             phone_profile.avatar,\n                             unix_timestamp(phone_messages_conversations.updatedAt)*1000 as updatedAt\n             FROM (SELECT conversation_id FROM phone_messages_conversations WHERE phone_messages_conversations.participant_identifier = ?) AS t\n                      LEFT OUTER JOIN phone_messages_conversations\n                                      ON phone_messages_conversations.conversation_id = t.conversation_id\n                      LEFT OUTER JOIN phone_profile\n                                      ON phone_profile.number = phone_messages_conversations.participant_identifier\n             WHERE updatedAt >= DATE_SUB(NOW(), INTERVAL 14 DAY)\n             ORDER BY phone_messages_conversations.updatedAt DESC",[e])}async getMessages(e){return await exports.oxmysql.query_async("SELECT DISTINCT phone_messages.id,\n                              phone_messages.conversation_id,\n                              phone_messages.message,\n                              phone_messages.author,\n                              phone_messages.createdAt\n                       FROM phone_messages\n                                LEFT JOIN phone_messages_conversations ON phone_messages.conversation_id = phone_messages_conversations.conversation_id\n                       WHERE phone_messages_conversations.participant_identifier = ? AND phone_messages.updatedAt >= DATE_SUB(NOW(), INTERVAL 14 DAY)\n                       ORDER BY id DESC",[e])}async createMessageGroup(e,t,r){await exports.oxmysql.insert_async("INSERT INTO phone_messages_conversations (user_identifier, conversation_id, participant_identifier) VALUES (?, ?, ?)",[e,t,r])}async getIdentifierFromPhoneNumber(e){return(await exports.oxmysql.query_async("SELECT citizenid FROM player WHERE charinfo LIKE ? LIMIT 1",["%"+e+"%"])).citizenid}async checkIfMessageGroupExists(e){return(await exports.oxmysql.single_async("SELECT COUNT(*) as count FROM phone_messages_conversations WHERE conversation_id = ?",[e])).count>0}async getMessageCountByGroup(e){return(await exports.oxmysql.single_async("SELECT COUNT(*) as count FROM phone_messages WHERE conversation_id = ?",[e])).count}async setMessageRead(e,t){await exports.oxmysql.query_async("UPDATE phone_messages_conversations SET unread = 0 WHERE conversation_id = ? AND NOT participant_identifier = ?",[e,t])}async setMessageArchived(e,t){await exports.oxmysql.query_async("UPDATE phone_messages_conversations SET masked = 1 WHERE conversation_id = ? AND participant_identifier = ?",[e,t])}async deleteConversation(e,t){await exports.oxmysql.query_async("DELETE\n                   FROM phone_messages_conversations\n                   WHERE conversation_id = ?\n                     AND participant_identifier = ?",[e,t])}async doesConversationExist(e,t){return await exports.oxmysql.single_async("SELECT *\n                   FROM phone_messages_conversations\n                   WHERE conversation_id = ?\n                     AND participant_identifier = ?",[e,t])}},oe=E.child({module:"messages"});async function ie(e){const t=await async function(e){return(await se.getMessageConversations(e)).reduce(((t,r)=>{const n=r.conversation_id;return r.participant_identifier!=e&&(t[n]={unread:r.unread,masked:r.masked,phoneNumber:r.participant_identifier,display:r.display,avatar:r.avatar,conversation_id:r.conversation_id,user_identifier:e,updatedAt:r.updatedAt}),t}),{})}(e);return(await async function(e,t){const r=[];for(const n of Object.keys(t))(t[n].user_identifier=e)&&r.push(n);return r}(e,t)).map((e=>({...t[e]})))}const ae=new class{async handleFetchMessageConversations(e,t){try{const r=S.getPlayer(e.source).getPhoneNumber();t({status:"ok",data:await ie(r)})}catch(e){t({status:"error",errorMsg:"DB_ERROR"}),oe.error(`Failed to fetch messages groups, ${e.toString()}`)}}async handleCreateMessageConversation(e,t){try{const r=S.getPlayer(e.source),n=await async function(e,t){const r=await S.getIdentifierFromPhoneNumber(t,!0);if(!r)throw new Error("tgtIdentifier was null");const n=((s=[e,t]).sort(),s.join("+"));var s;const o=await se.doesConversationExist(n,t);return o||(await se.createMessageGroup(e,n,e),await se.createMessageGroup(e,n,t)),{error:!1,doesExist:o,conversationId:n,identifiers:[e,t],phoneNumber:t,participant:r,updatedAt:(new Date).getTime()}}(r.getPhoneNumber(),e.data.targetNumber);if(n.error)return t({status:"error"});try{const e=S.getPlayerFromIdentifier(n.participant);e&&emitNet(ne.CREATE_MESSAGE_CONVERSATION_SUCCESS,e.source,{conversation_id:n.conversationId,phoneNumber:r.getPhoneNumber(),updatedAt:n.updatedAt})}catch(e){t({status:"error",errorMsg:e.toString()}),oe.error(e.toString())}emitNet(ne.CREATE_MESSAGE_CONVERSATION_SUCCESS,e.source,{conversation_id:n.conversationId,phoneNumber:n.phoneNumber,updatedAt:n.updatedAt}),t({status:"ok",data:{conversation_id:n.conversationId,phoneNumber:n.phoneNumber,updatedAt:n.updatedAt}})}catch(r){t({status:"error",errorMsg:"DB_ERROR"}),oe.error(`Failed to create message group, ${r.toString()}`,{source:e.source,e:r})}}async handleFetchMessages(e,t){try{const r=S.getPlayer(e.source).getPhoneNumber();t({status:"ok",data:await this.messagesDB.getMessages(r)})}catch(r){t({status:"error",errorMsg:"DB_ERROR"}),oe.error(`Failed to fetch messages, ${r.toString()}`,{source:e.source})}}async handleSendMessage(e,t){try{const r=S.getPlayer(e.source),n=r.getPhoneNumber(),s=e.data,o=s.conversationId.split("+"),i=r.getIdentifier(),a=await this.messagesDB.createMessage(i,n,s.conversationId,s.message);t({status:"ok",data:{...s,conversation_id:s.conversationId,author:n,id:a,createdAt:(new Date).getTime()}});for(const t of o)if(t!==r.getPhoneNumber()){const o=await S.getIdentifierByPhoneNumber(t),i=S.getPlayerFromIdentifier(o);i&&(emitNet(ne.SEND_MESSAGE_SUCCESS,i.source,{...s,conversation_id:s.conversationId,author:n,id:a,createdAt:(new Date).getTime()}),emitNet(ne.CREATE_MESSAGE_BROADCAST,i.source,{conversationName:r.getPhoneNumber(),conversationId:s.conversationId,message:s.message}),emitNet(ne.UPDATE_MESSAGE_CONVERSATION_SUCCESS,i.source,{conversation_id:s.conversationId,phoneNumber:n,updatedAt:(new Date).getTime(),unread:1})),emitNet(ne.UPDATE_MESSAGE_CONVERSATION_SUCCESS,e.source,{conversation_id:s.conversationId,phoneNumber:t,updatedAt:(new Date).getTime(),unread:0})}emitNet(ne.SEND_MESSAGE_SUCCESS,e.source,{...s,conversation_id:s.conversationId,author:n,id:a,createdAt:(new Date).getTime()})}catch(r){t({status:"error",errorMsg:r.toString()}),oe.error(`Failed to send message, ${r.toString()}`,{source:e.source})}}async handleSetMessageRead(e,t){try{const r=S.getPlayer(e).getPhoneNumber();await this.messagesDB.setMessageRead(t,r),emitNet(ne.FETCH_MESSAGE_CONVERSATIONS,e)}catch(t){oe.error(`Failed to set message as read, ${t.toString()}`,{source:e})}}async handleSetConversationArchived(e,t){try{const r=S.getPlayer(e).getPhoneNumber();await this.messagesDB.setMessageArchived(t,r)}catch(t){oe.error(`Failed to set message as read, ${t.toString()}`,{source:e})}}async handleDeleteConversation(e,t){try{const r=S.getPlayer(e.source).getPhoneNumber();for(const t of e.data.conversationsId)await this.messagesDB.deleteConversation(t,r);t({status:"ok"})}catch(r){t({status:"error",errorMsg:"DB_ERROR"}),oe.error(`Failed to delete conversation, ${r.toString()}`,{source:e.source})}}constructor(){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"messagesDB",void 0),this.messagesDB=se,oe.debug("Messages service started")}},ce=ae;N(ne.FETCH_MESSAGE_CONVERSATIONS,(async(e,t)=>{ce.handleFetchMessageConversations(e,t).catch((r=>{oe.error(`Error occurred in fetch message conversations (${e.source}), Error: ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(ne.CREATE_MESSAGE_CONVERSATION,(async(e,t)=>{ce.handleCreateMessageConversation(e,t).catch((r=>{oe.error(`Error occurred on creating messsage converations (${e.source}), Error: ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(ne.FETCH_MESSAGES,(async(e,t)=>{ce.handleFetchMessages(e,t).catch((r=>{oe.error(`Error occurred in fetch messages (${e.source}), Error: ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(ne.SEND_MESSAGE,(async(e,t)=>{ce.handleSendMessage(e,t).catch((r=>{oe.error(`Error occurred while sending message (${e.source}), Error: ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(ne.DELETE_CONVERSATION,(async(e,t)=>{ce.handleDeleteConversation(e,t).catch((r=>{oe.error(`Error occurred while deleting conversation (${e.source}), Error: ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(ne.SET_MESSAGE_READ,(async(e,t)=>{const r=i();ce.handleSetMessageRead(r,e.data.conversation_id).catch((e=>{oe.error(`Error occurred in set message read event (${r}), Error: ${e.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})})),t({status:"ok"})})),N(ne.SET_CONVERSATION_ARCHIVED,(async(e,t)=>{const r=i();ce.handleSetConversationArchived(r,e.data.conversation_id).catch((e=>{oe.error(`Error occurred in set message read event (${r}), Error: ${e.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})})),t({status:"ok"})}));const le=new class{async addSociety(e,{number:t,message:r,pedPosition:n}){return await exports.oxmysql.insert_async("INSERT INTO phone_society_messages (conversation_id, source_phone, message, position) VALUES (?, ?, ?, ?)",[t,e,r,n])}async updateMessage({id:e,take:t,takenBy:r,takenByUsername:n,done:s}){return 1===await exports.oxmysql.update_async("UPDATE phone_society_messages SET isTaken=?, takenBy=?, takenByUsername=?, isDone=? WHERE id=?",[t,r,n,s,e])}async getMessage(e){return await exports.oxmysql.single_async("SELECT *, unix_timestamp(createdAt)*1000 as createdAt, unix_timestamp(updatedAt)*1000 as updatedAt FROM phone_society_messages WHERE id = ?",[e])}async getMessages(e){return await exports.oxmysql.query_async("SELECT *, unix_timestamp(createdAt)*1000 as createdAt, unix_timestamp(updatedAt)*1000 as updatedAt FROM phone_society_messages WHERE conversation_id = ? AND updatedAt > date_sub(now(), interval 2 day)",[e])}},ue=E.child({module:"society"}),de=new class{createMessageBroadcastEvent(e,t,r,n){emitNet(s.CREATE_MESSAGE_BROADCAST,e,{id:t,conversation_id:n.number,source_phone:r.includes("#")?"":r,message:n.message,position:n.pedPosition,isTaken:!1,isDone:!1,muted:!Player(e).state.onDuty,createdAt:(new Date).getTime()})}replaceSocietyPhoneNumber(e,t){return e.number=t,e}addTagForSocietyMessage(e,t){const r={...e};return r.message=`[${t.replace("555-","")}] ${r.message}`,r}async handleSendSocietyMessage(e,t){const r=S.getPlayer(e.source),n=e.data.number;let s=r.getPhoneNumber();if(e.data.position){const t=GetPlayerPed(e.source.toString()),[r,n,s]=GetEntityCoords(t);e.data.pedPosition=JSON.stringify({x:r,y:n,z:s})}e.data.overrideIdentifier&&(s=e.data.overrideIdentifier),e.data.anonymous&&(s=`#${s}`),"555-FBI"===e.data.number&&await global.exports["op-utils"].SendHTTPRequest("discord_webhook_fbi",{title:"Federal Bureau of Investigation",content:`**Nouveau message reçu : ** \`${r.getPhoneNumber()} - ${r.username}\` \`\`\`${e.data.message}\`\`\` `});try{const r=await this.contactsDB.addSociety(s,e.data);t({status:"ok",data:r});const o=await S.getPlayersFromSocietyNumber(e.data.number);if(o.forEach((t=>{this.createMessageBroadcastEvent(t.source,r,s,e.data)})),"555-LSMC"===e.data.number&&0==o.length){const t=await S.getPlayersFromSocietyNumber("555-LSPD"),r=await S.getPlayersFromSocietyNumber("555-BCSO"),o={"555-LSPD":await this.contactsDB.addSociety(s,this.replaceSocietyPhoneNumber(this.addTagForSocietyMessage(e.data,n),"555-LSPD")),"555-BCSO":await this.contactsDB.addSociety(s,this.replaceSocietyPhoneNumber(this.addTagForSocietyMessage(e.data,n),"555-BCSO"))};[t,r].reduce(((e,t)=>e.concat(t)),[]).forEach((t=>{this.createMessageBroadcastEvent(t.source,o[t.getSocietyPhoneNumber()],s,this.addTagForSocietyMessage(e.data,n))}))}if("555-POLICE"===e.data.number){const t=await S.getPlayersFromSocietyNumber("555-LSPD"),r=await S.getPlayersFromSocietyNumber("555-BCSO"),o=await S.getPlayersFromSocietyNumber("555-FBI"),i={"555-LSPD":await this.contactsDB.addSociety(s,this.replaceSocietyPhoneNumber(this.addTagForSocietyMessage(e.data,n),"555-LSPD")),"555-BCSO":await this.contactsDB.addSociety(s,this.replaceSocietyPhoneNumber(this.addTagForSocietyMessage(e.data,n),"555-BCSO")),"555-FBI":await this.contactsDB.addSociety(s,this.replaceSocietyPhoneNumber(this.addTagForSocietyMessage(e.data,n),"555-FBI"))};[t,r,o].reduce(((e,t)=>e.concat(t)),[]).forEach((t=>{this.createMessageBroadcastEvent(t.source,i[t.getSocietyPhoneNumber()],s,this.addTagForSocietyMessage(e.data,n))}))}}catch(e){ue.error(`Error in handleAddSociety, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async updateSocietyMessage(e,t){const r=S.getPlayer(e.source),n=r.getSocietyPhoneNumber();try{e.data.takenBy=r.getIdentifier(),e.data.takenByUsername=r.username,t({status:"ok",data:await this.contactsDB.updateMessage(e.data)});const o=await this.contactsDB.getMessage(e.data.id);if(o){const e=await S.getPlayersFromNumber(o.source_phone.replace("#",""));e&&o.isTaken&&!o.isDone&&emitNet("hud:client:DrawNotification",e.source,`Votre ~b~appel~s~ au ${o.conversation_id} vient d'être pris !`,"info",1e4)}o.source_phone.includes("#")&&(o.source_phone=""),(await S.getPlayersFromSocietyNumber(n)).forEach((e=>{emitNet(s.UPDATE_SOCIETY_MESSAGE_SUCCESS,e.source,o)}))}catch(e){ue.error(`Error in handleAddSociety, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async fetchSocietyMessages(e,t){const r=S.getPlayer(e.source).getSocietyPhoneNumber();try{t({status:"ok",data:(await this.contactsDB.getMessages(r)).map((e=>({...e,source_phone:e.source_phone.includes("#")?"":e.source_phone})))})}catch(e){ue.error(`Error in handleAddSociety, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}constructor(){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"contactsDB",void 0),this.contactsDB=le,ue.debug("Societies service started")}},he=de;var fe,pe;N(s.SEND_SOCIETY_MESSAGE,((e,t)=>{he.handleSendSocietyMessage(e,t).catch((r=>{ue.error(`Error occured in fetch contacts event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(s.FETCH_SOCIETY_MESSAGES,((e,t)=>{he.fetchSocietyMessages(e,t).catch((r=>{ue.error(`Error occured in fetch contacts event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(s.UPDATE_SOCIETY_MESSAGE,((e,t)=>{he.updateSocietyMessage(e,t).catch((r=>{ue.error(`Error occured in updateSocietyMessage event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(s.RESET_SOCIETY_MESSAGES,((e,t)=>{he.fetchSocietyMessages(e,t).catch((r=>{ue.error(`Error occured in fetch contacts event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),function(e){e[e.message=255]="message"}(fe||(fe={})),function(e){e.FETCH_NEWS="phone:app:news:fetchNews",e.RELOAD_NEWS="phone:app:news:reloadNews",e.CREATE_NEWS_BROADCAST="phone:app:news:createNewsBroadcast",e.API_NEWS_BROADCAST="op-api:server:AddFlashNews"}(pe||(pe={}));const ge=new class{async addNews({type:e,image:t,message:r,reporter:n,reporterId:s}){return await exports.oxmysql.insert_async("INSERT INTO phone_twitch_news (type, image, message, reporter, reporterId) VALUES (?, ?, ?, ?, ?)",[e,t,r,n,s])}async getNews(){return await exports.oxmysql.query_async("SELECT *, unix_timestamp(createdAt)*1000 as createdAt FROM phone_twitch_news WHERE createdAt > date_sub(now(), interval 2 day)",[])}},me=E.child({module:"twitch-news"}),ye=new class{async handleSendNews(e,t){try{const r=await this.twitchNewsDB.addNews(e.data);t({status:"ok",data:r}),emit(pe.API_NEWS_BROADCAST,{type:e.data.type,message:e.data.message,reporter:e.data.reporter,reporterId:e.data.reporterId,image:e.data.image}),emitNet(pe.CREATE_NEWS_BROADCAST,-1,{id:r,type:e.data.type,reporter:e.data.reporter,reporterId:e.data.reporterId,image:e.data.image,message:e.data.message,createdAt:(new Date).getTime()}),emitNet("hud:client:DrawNewsBanner",-1,e.data.type,e.data.message,e.data.reporter)}catch(e){me.error(`Error in handleAddSociety, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async fetchNews(e,t){try{t({status:"ok",data:await this.twitchNewsDB.getNews()})}catch(e){me.error(`Error in handleAddSociety, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}constructor(){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"twitchNewsDB",void 0),this.twitchNewsDB=ge,me.debug("Societies service started")}},Ee=ye;var _e;N(pe.FETCH_NEWS,((e,t)=>{Ee.fetchNews(e,t).catch((r=>{me.error(`Error occured in fetch news event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(pe.CREATE_NEWS_BROADCAST,((e,t)=>{Ee.handleSendNews(e,t).catch((r=>{me.error(`Error occured in fetch contacts event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),function(e){e.GET_AVATAR="phone:getAvatar",e.UPDATE_PICTURE="phone:updateProfilePicture"}(_e||(_e={}));const be=new class{async addPicture(e,{number:t,url:r}){return await exports.oxmysql.insert_async("INSERT INTO phone_profile (number, avatar) VALUES (?, ?) ON DUPLICATE KEY UPDATE avatar=?",[t,r,r])}async getProfilePicture(e){const t=await exports.oxmysql.single_async("SELECT avatar FROM phone_profile WHERE number = ?",[e]);return t?t.avatar:null}},ve=E.child({module:"settings"}),Se=new class{async handleUpdateProfilePicture(e,t){const r=S.getPlayer(e.source).getPhoneNumber();try{t({status:"ok",data:await this.settingsDB.addPicture(r,e.data)})}catch(e){ve.error(`Error in handleAddSociety, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}async getProfilePicture(e,t){const r=S.getPlayer(e.source).getPhoneNumber();try{t({status:"ok",data:await this.settingsDB.getProfilePicture(r)})}catch(e){ve.error(`Error in getProfilePicture, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}constructor(){!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"settingsDB",void 0),this.settingsDB=be,ve.debug("Settings service started")}},we=Se;var Te;N(_e.UPDATE_PICTURE,((e,t)=>{we.handleUpdateProfilePicture(e,t).catch((r=>{ve.error(`Error occured in fetch contacts event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),N(_e.GET_AVATAR,((e,t)=>{we.getProfilePicture(e,t).catch((r=>{ve.error(`Error occured in fetch contacts event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"INTERNAL_ERROR"})}))})),function(e){e.FIVEM_EVENT_FETCH_BALANCE="phone:app:bank:fetchBalance",e.FIVEM_EVENT_UPDATE_BALANCE="phone:client:app:bank:updateBalance",e.GET_CREDENTIALS="phone:app:bank:getAccountData",e.SEND_CREDENTIALS="phone:app:bank:sendAccountData"}(Te||(Te={}));const Re=E.child({module:"bank"}),Ne=new class{async handleFetchAccount(e,t){try{t({status:"ok",data:exports["op-bank"].GetPlayerAccount(e.source)})}catch(e){Re.error(`Error in handleFetchAccount, ${e.toString()}`),t({status:"error",errorMsg:"DB_ERROR"})}}};N(Te.FIVEM_EVENT_FETCH_BALANCE,((e,t)=>{Ne.handleFetchAccount(e,t).catch((r=>{Re.error(`Error occured in fetch bank event (${e.source}), Error:  ${r.message}`),t({status:"error",errorMsg:"UNKNOWN_ERROR"})}))}))})()})();